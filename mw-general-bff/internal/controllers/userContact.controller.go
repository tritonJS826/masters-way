package controllers

import (
	openapiGeneral "mw-general-bff/apiAutogenerated/general"
	"mw-general-bff/internal/facades"
	"mw-general-bff/internal/schemas"
	"mw-general-bff/pkg/utils"
	"net/http"

	"github.com/gin-gonic/gin"
)

// Without next lines swagger does not see openapi models
var _ = &openapiGeneral.MwServerInternalSchemasUserContact{}

type UserContactController struct {
	userContactFacade *facades.UserContactFacade
}

func NewUserContactController(userContactFacade *facades.UserContactFacade) *UserContactController {
	return &UserContactController{userContactFacade}
}

// func (uc *UserTagController) AddUserTagByName(ctx *gin.Context) {
// 	var payload *schemas.CreateUserTagPayload

// 	if err := ctx.ShouldBindJSON(&payload); err != nil {
// 		ctx.JSON(http.StatusBadRequest, gin.H{"status": "Failed payload", "error": err.Error()})
// 		return
// 	}

// 	responseRaw, err := uc.userContactFacade.AddUserTagByName(ctx, payload)
// 	utils.HandleErrorGin(ctx, err)

// 	response := schemas.UserTagResponse{
// 		Uuid: responseRaw.Uuid,
// 		Name: responseRaw.Name,
// 	}

// 	ctx.JSON(http.StatusOK, response)
// }

// func (uc *UserTagController) DeleteUserTagByFromUserByTag(ctx *gin.Context) {

// }

// @Summary Update user contact by UUID
// @Description
// @Tags userContact
// @ID update-userContact
// @Accept  json
// @Produce  json
// @Param request body schemas.UpdateUserContactPayload true "query params"
// @Param userId path string true "user ID"
// @Param contactId path string true "contactId ID"
// @Success 200 {object} schemas.UserContact
// @Router /users/{userId}/contact/{contactId} [patch]
func (uc *UserContactController) UpdateUserContact(ctx *gin.Context) {
	userID := ctx.Param("userId")
	contactId := ctx.Param("contactId")

	var payload *schemas.UpdateUserContactPayload
	if err := ctx.ShouldBindJSON(&payload); err != nil {
		ctx.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		return
	}

	userContact, err := uc.userContactFacade.UpdateUserContact(ctx, userID, contactId, &openapiGeneral.MwServerInternalSchemasUpdateUserContactPayload{
		Description: payload.Description,
		ContactLink: payload.ContactLink,
	})
	utils.HandleErrorGin(ctx, err)

	ctx.JSON(http.StatusOK, userContact)
}

// Create user contact handler
// @Summary Create user contact
// @Description create user contact
// @Tags user-contact user
// @ID create-userContact
// @Accept  json
// @Produce  json
// @Param userId path string true "user ID"
// @Success 200 {object} schemas.UserContact
// @Router /users/{userId}/contacts [post]
func (uc *UserContactController) CreateUserContact(ctx *gin.Context) {
	userID := ctx.Param("userId")

	userContact, err := uc.userContactFacade.CreateUserContact(ctx, userID)
	utils.HandleErrorGin(ctx, err)

	ctx.JSON(http.StatusOK, userContact)
}

// Deleting userContact handlers
// @Summary Delete DeleteUserContact by UUID
// @Description
// @Tags userContact
// @ID delete-userContact
// @Accept  json
// @Produce  json
// @Param userId path string true "user ID"
// @Param contactId path string true "contactId ID"
// @Success 204
// @Router /users/{userId}/contacts/{contactId} [delete]
func (uc *UserContactController) DeleteUserContact(ctx *gin.Context) {
	userID := ctx.Param("userId")
	contactId := ctx.Param("contactId")

	err := uc.userContactFacade.DeleteUserContact(ctx, userID, contactId)
	utils.HandleErrorGin(ctx, err)

	ctx.Status(http.StatusNoContent)
}
