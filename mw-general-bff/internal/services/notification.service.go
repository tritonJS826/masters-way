package services

import (
	"context"
	pb "mw-general-bff/pkg/grpcAutoGenerated/notification"
)

type NotificationService struct {
	notificationGRPC        pb.NotificationServiceClient
	notificationSettingGRPC pb.NotificationSettingServiceClient
}

func newNotificationService(
	notificationGRPC pb.NotificationServiceClient,
	notificationSettingGRPC pb.NotificationSettingServiceClient,
) *NotificationService {
	return &NotificationService{notificationGRPC, notificationSettingGRPC}
}

type Nature string

const (
	PrivateChat      Nature = "private_chat"
	GroupChat        Nature = "group_chat"
	OwnWay           Nature = "own_way"
	MentoringWay     Nature = "mentoring_way"
	MentoringRequest Nature = "mentoring_request"
	FavoriteWay      Nature = "favorite_way"
)

func (ns *NotificationService) CreateNotifications(ctx context.Context, params *pb.CreateNotificationRequest) (*pb.CreateNotificationsResponse, error) {
	in := &pb.CreateNotificationRequest{
		Recievers:        []*pb.Recievers{},
		DataForRecievers: nil,
		Nature:           pb.Nature(pb.Nature_value[string(params.Nature)]),
	}

	// UserUuids:   params.UserUUIDs,
	// Description: params.Description,
	// Url:         params.Url,
	createNotificationsResponseRaw, err := ns.notificationGRPC.CreateNotifications(ctx, in)
	if err != nil {
		return nil, err
	}

	return createNotificationsResponseRaw, nil
}

func (ns *NotificationService) CreateNotificationSettings(ctx context.Context, userUUID string) error {
	in := &pb.CreateNotificationSettingsRequest{
		UserUuid: userUUID,
	}

	_, err := ns.notificationSettingGRPC.CreateNotificationSettings(ctx, in)
	if err != nil {
		return err
	}

	return nil
}
