package services

import (
	"context"
	pb "mw-general-bff/pkg/grpcAutoGenerated/training"

	"google.golang.org/protobuf/types/known/emptypb"
)

type TrainingService struct {
	trainingGRPC            pb.TrainingServiceClient
	trainingMessageToAiGRPC pb.TrainingMessageToAIServiceClient
}

func newTrainingService(
	trainingGRPC pb.TrainingServiceClient,
	trainingMessageToAiGRPC pb.TrainingMessageToAIServiceClient,
) *TrainingService {
	return &TrainingService{trainingGRPC, trainingMessageToAiGRPC}
}

func (ts *TrainingService) GetTrainingById(ctx context.Context, trainingId string) (*pb.Training, error) {
	training, err := ts.trainingGRPC.GetTrainingById(ctx, &pb.GetTrainingRequest{TrainingUuid: trainingId})
	if err != nil {
		return nil, err
	}
	return training, nil
}

func (ts *TrainingService) GetMessageToAI(ctx context.Context) (*pb.MessageToAI, error) {
	message, err := ts.trainingMessageToAiGRPC.GetMessageToAI(ctx, &emptypb.Empty{})
	if err != nil {
		return nil, err
	}
	return message, nil
}

func (ts *TrainingService) HandleResponseFromAiForItem(ctx context.Context, messageFromAi *pb.MessageFromAI) error {
	_, err := ts.trainingMessageToAiGRPC.HandleResponseFromAiForItem(ctx, messageFromAi)
	if err != nil {
		return err
	}
	return nil
}
