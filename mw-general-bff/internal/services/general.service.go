package services

import (
	"context"
	"fmt"

	"mw-general-bff/internal/schemas"
	"mw-general-bff/pkg/utils"
	"time"

	"github.com/gin-gonic/gin"
	"github.com/samber/lo"

	openapiGeneral "mw-general-bff/apiAutogenerated/general"

	"github.com/google/uuid"
)

type GeneralService struct {
	generalAPI *openapiGeneral.APIClient
}

func NewGeneralService(generalAPI *openapiGeneral.APIClient) *GeneralService {
	return &GeneralService{generalAPI}
}

func (gs *GeneralService) CreateComment(ctx context.Context, payload *schemas.CreateCommentPayload) (*schemas.CommentPopulatedResponse, error) {
	commentRaw, response, err := gs.generalAPI.CommentAPI.CreateComment(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateCommentPayload{
		DayReportUuid: payload.DayReportUuid,
		Description:   payload.Description,
		OwnerUuid:     payload.OwnerUuid,
	}).Execute()
	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	comment := &schemas.CommentPopulatedResponse{
		Uuid:          commentRaw.Uuid,
		Description:   commentRaw.Description,
		OwnerUuid:     commentRaw.OwnerUuid,
		OwnerName:     commentRaw.OwnerName,
		CreatedAt:     commentRaw.CreatedAt,
		UpdatedAt:     commentRaw.UpdatedAt,
		DayReportUuid: commentRaw.DayReportUuid,
		WayUUID:       commentRaw.WayUuid,
		WayName:       commentRaw.WayName,
	}

	return comment, nil
}

type UpdateCommentParams struct {
	CommentID   string
	Description *string
}

func (gs *GeneralService) UpdateComment(ctx context.Context, params *UpdateCommentParams) (*schemas.CommentPopulatedResponse, error) {
	updateReq := openapiGeneral.MwserverInternalSchemasUpdateCommentPayload{
		Description: params.Description,
	}

	updatedCommentRaw, response, err := gs.generalAPI.CommentAPI.UpdateComment(ctx, params.CommentID).Request(updateReq).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	updatedComment := &schemas.CommentPopulatedResponse{
		Uuid:          updatedCommentRaw.Uuid,
		Description:   updatedCommentRaw.Description,
		OwnerUuid:     updatedCommentRaw.OwnerUuid,
		OwnerName:     updatedCommentRaw.OwnerName,
		CreatedAt:     updatedCommentRaw.CreatedAt,
		UpdatedAt:     updatedCommentRaw.UpdatedAt,
		DayReportUuid: updatedCommentRaw.DayReportUuid,
		WayUUID:       updatedCommentRaw.WayUuid,
		WayName:       updatedCommentRaw.WayName,
	}

	return updatedComment, nil
}

func (gs *GeneralService) DeleteCommentById(ctx context.Context, commentID string) error {
	response, err := gs.generalAPI.CommentAPI.DeleteComment(ctx, commentID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

type AddWayToCompositeWayParams struct {
	ChildWayID  string
	ParentWayID string
}

func (gs *GeneralService) AddWayToCompositeWay(ctx context.Context, params *schemas.AddWayToCompositeWayPayload) (*schemas.CompositeWayRelation, error) {
	relationRaw, response, err := gs.generalAPI.CompositeWayAPI.CreateCompositeWay(ctx).Request(openapiGeneral.MwserverInternalSchemasAddWayToCompositeWayPayload{
		ChildWayUuid:  params.ChildWayUuid,
		ParentWayUuid: params.ParentWayUuid,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	relation := &schemas.CompositeWayRelation{
		ChildWayUuid:  relationRaw.ChildWayUuid,
		ParentWayUuid: relationRaw.ParentWayUuid,
	}

	return relation, nil
}

func (gs *GeneralService) DeleteCompositeWayRelation(ctx context.Context, parentWayID, childWayID string) error {
	response, err := gs.generalAPI.CompositeWayAPI.DeleteCompositeWayRelation(ctx, parentWayID, childWayID).Execute()
	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

//type DayReportService struct {
//	dayReportRepository IDayReportRepository
//}
//
//func NewDayReportService(dayReportRepository IDayReportRepository) *DayReportService {
//	return &DayReportService{dayReportRepository}
//}

type GetDayReportsByWayIdParams struct {
	WayUUID string
	Page    int
	Limit   int
}

func (gs *GeneralService) GetDayReportsByWayID(ctx context.Context, params *GetDayReportsByWayIdParams) (*openapiGeneral.MwserverInternalSchemasListDayReportsResponse, error) {
	reports, response, err := gs.generalAPI.DayReportAPI.GetDayReports(ctx, params.WayUUID).Page(int32(params.Page)).Limit(int32(params.Limit)).Execute()
	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}
	return reports, nil
}

type GetLastDayReportDateResponse struct {
	TotalStartDate time.Time
	EndDate        time.Time
}

func (gs *GeneralService) GetLastDayReportDate(ctx context.Context, wayUUIDs []uuid.UUID) (*GetLastDayReportDateResponse, error) {
	return nil, nil
}

func (gs *GeneralService) CreateDayReport(ctx context.Context, wayID string) (*openapiGeneral.MwserverInternalSchemasCompositeDayReportPopulatedResponse, error) {
	dayReports, response, err := gs.generalAPI.DayReportAPI.CreateDayReport(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateDayReportPayload{
		WayId: wayID,
	}).Execute()
	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}
	return dayReports, nil
}

func (gs *GeneralService) CreateFavoriteUser(ctx context.Context, payload *schemas.CreateFavoriteUserPayload) error {
	response, err := gs.generalAPI.FavoriteUserAPI.CreateFavoriteUser(ctx).
		Request(openapiGeneral.MwserverInternalSchemasCreateFavoriteUserPayload{
			DonorUserUuid:    payload.DonorUserUuid.String(),
			AcceptorUserUuid: payload.AcceptorUserUuid.String(),
		}).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) DeleteFavoriteUserById(ctx context.Context, donorUserUuid, acceptorUserUuid string) error {
	response, err := gs.generalAPI.FavoriteUserAPI.DeleteFavoriteUser(ctx, donorUserUuid, acceptorUserUuid).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreateFavoriteUserWay(ctx context.Context, userUUID, wayUUID uuid.UUID) error {
	response, err := gs.generalAPI.FavoriteUserWayAPI.CreateFavoriteUserWay(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateFavoriteUserWayPayload{
		UserUuid: userUUID.String(),
		WayUuid:  wayUUID.String(),
	}).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (fuws *GeneralService) DeleteFavoriteUserWayById(ctx context.Context, userID, wayID string) error {
	response, err := fuws.generalAPI.FavoriteUserWayAPI.DeleteFavoriteUserWay(ctx, userID, wayID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreateFromUserMentoringRequest(ctx context.Context, userID, wayID string) (*schemas.FromUserMentoringRequestResponse, error) {
	fromUserMentoringRaw, response, err := gs.generalAPI.FromUserMentoringRequestAPI.CreateFromUserMentoringRequest(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateFromUserMentoringRequestPayload{
		UserUuid: userID,
		WayUuid:  wayID,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	result := &schemas.FromUserMentoringRequestResponse{
		UserID: fromUserMentoringRaw.UserId,
		WayID:  fromUserMentoringRaw.WayId,
	}

	return result, nil
}

func (gs *GeneralService) DeleteFromUserMentoringRequestById(ctx context.Context, userID, wayID string) error {
	response, err := gs.generalAPI.FromUserMentoringRequestAPI.DeleteFromUserMentoringRequest(ctx, userID, wayID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreateMetricsPrompt(ctx context.Context, payload *schemas.GenerateMetricsPayload) (*schemas.GenerateMetricsResponse, error) {
	metricsRow, response, err := gs.generalAPI.GeminiAPI.GenerateMetrics(ctx).Request(openapiGeneral.MwserverInternalSchemasGenerateMetricsPayload{
		GoalDescription: payload.GoalDescription,
		Metrics:         payload.Metrics,
		WayName:         payload.WayName,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	metrics := &schemas.GenerateMetricsResponse{
		Metrics: &metricsRow.Metrics,
	}

	return metrics, nil
}

func (gs *GeneralService) AIChat(ctx context.Context, payload *schemas.AIChatPayload) (*schemas.AIChatResponse, error) {
	aiChatRow, response, err := gs.generalAPI.GeminiAPI.AiChat(ctx).Request(openapiGeneral.MwserverInternalSchemasAIChatPayload{
		Message: payload.Message,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}
	aiChat := &schemas.AIChatResponse{
		Message: aiChatRow.Message,
	}

	return aiChat, nil
}

func (gs *GeneralService) GeneratePlansByMetric(ctx context.Context, payload *schemas.AIGeneratePlansByMetricPayload) (*schemas.AIGeneratePlansByMetricResponse, error) {
	plansRaw, response, err := gs.generalAPI.GeminiAPI.AiPlansByMetrics(ctx).Request(openapiGeneral.MwserverInternalSchemasAIGeneratePlansByMetricPayload{
		Goal:   payload.Goal,
		Metric: payload.Metric,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	plans := &schemas.AIGeneratePlansByMetricResponse{
		Plans: plansRaw.Plans,
	}

	return plans, nil
}

func (gs *GeneralService) CommentIssue(ctx context.Context, payload *schemas.AICommentIssuePayload) (*schemas.AICommentIssueResponse, error) {
	commentRaw, response, err := gs.generalAPI.GeminiAPI.AiCommentIssue(ctx).Request(openapiGeneral.MwserverInternalSchemasAICommentIssuePayload{
		Goal:    payload.Goal,
		Message: payload.Message,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	comment := &schemas.AICommentIssueResponse{
		Comment: commentRaw.Goal,
	}

	return comment, nil
}

func (gs *GeneralService) DecomposeIssue(ctx context.Context, payload *schemas.AIDecomposeIssuePayload) (*schemas.AIDecomposeIssueResponse, error) {
	plansRaw, response, err := gs.generalAPI.GeminiAPI.AiDecomposeIssue(ctx).Request(openapiGeneral.MwserverInternalSchemasAIDecomposeIssuePayload{
		Goal:    payload.Goal,
		Message: payload.Message,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	decompose := &schemas.AIDecomposeIssueResponse{
		Plans: plansRaw.Plans,
	}

	return decompose, nil
}

func (gs *GeneralService) EstimateIssue(ctx context.Context, payload *schemas.AIEstimateIssuePayload) (*schemas.AIEstimateIssueResponse, error) {
	estimateRaw, response, err := gs.generalAPI.GeminiAPI.AiEstimateIssue(ctx).Request(openapiGeneral.MwserverInternalSchemasAIEstimateIssuePayload{
		Goal:  payload.Goal,
		Issue: payload.Issue,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	estimate := &schemas.AIEstimateIssueResponse{
		Estimation: estimateRaw.Estimation,
	}

	return estimate, nil
}

func (gs *GeneralService) CreateJobDone(ctx context.Context, payload *schemas.CreateJobDonePayload) (*openapiGeneral.MwserverInternalSchemasJobDonePopulatedResponse, error) {
	jobDone, response, err := gs.generalAPI.JobDoneAPI.CreateJobDone(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateJobDonePayload{
		DayReportUuid: payload.DayReportUuid,
		Description:   payload.Description,
		JobTagUuids:   payload.JobTagUuids,
		OwnerUuid:     payload.OwnerUuid,
		Time:          payload.Time,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return jobDone, nil
}

type UpdateJobDoneParams struct {
	JobDoneID   string
	Description *string
	Time        *int32
}

func (gs *GeneralService) UpdateJobDone(ctx context.Context, params *UpdateJobDoneParams) (*openapiGeneral.MwserverInternalSchemasJobDonePopulatedResponse, error) {
	jobDone, response, err := gs.generalAPI.JobDoneAPI.UpdateJobDone(ctx, params.JobDoneID).Request(openapiGeneral.MwserverInternalSchemasUpdateJobDone{
		Description: params.Description,
		Time:        params.Time,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return jobDone, nil
}

func (gs *GeneralService) DeleteJobDoneByID(ctx context.Context, jobDoneID string) error {
	response, err := gs.generalAPI.JobDoneAPI.DeleteJobDone(ctx, jobDoneID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreateJobDoneJobTag(ctx context.Context, payload *schemas.CreateJobDoneJobTagPayload) error {
	response, err := gs.generalAPI.JobDoneJobTagAPI.CreateJobDoneJobTag(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateJobDoneJobTagPayload{
		JobDoneUuid: payload.JobDoneUuid,
		JobTagUuid:  payload.JobTagUuid,
	}).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) DeleteJobDoneJobTagById(ctx context.Context, jobDoneID, jobTagID string) error {
	response, err := gs.generalAPI.JobDoneJobTagAPI.DeleteJobDoneJobTag(ctx, jobDoneID, jobTagID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreateJobTag(ctx context.Context, payload *schemas.CreateJobTagPayload) (*schemas.JobTagResponse, error) {
	jobTagRaw, response, err := gs.generalAPI.JobTagAPI.CreateJobTag(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateJobTagPayload{
		Color:       payload.Color,
		Description: payload.Description,
		Name:        payload.Name,
		WayUuid:     payload.WayUuid,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	jobTag := &schemas.JobTagResponse{
		Uuid:        jobTagRaw.Uuid,
		Name:        jobTagRaw.Name,
		Description: jobTagRaw.Description,
		Color:       jobTagRaw.Color,
	}

	return jobTag, nil

}

// TODO
func (gs *GeneralService) GetLabelsByIDs(ctx context.Context, jobTagIDs []string) ([]schemas.JobTagResponse, error) {
	return nil, nil
}

type UpdateJobTagParams struct {
	JobTagID    string
	Name        string
	Description string
	Color       string
}

func (gs *GeneralService) UpdateJobTag(ctx context.Context, params *UpdateJobTagParams) (*schemas.JobTagResponse, error) {
	jobTagRaw, response, err := gs.generalAPI.JobTagAPI.UpdateJobTag(ctx, params.JobTagID).Request(openapiGeneral.MwserverInternalSchemasUpdateJobTagPayload{
		Name:        &params.Name,
		Description: &params.Description,
		Color:       &params.Color,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	jobTag := &schemas.JobTagResponse{
		Uuid:        jobTagRaw.Uuid,
		Name:        jobTagRaw.Name,
		Description: jobTagRaw.Description,
		Color:       jobTagRaw.Color,
	}

	return jobTag, nil
}

func (gs *GeneralService) DeleteJobTagById(ctx context.Context, jobTagID string) error {
	response, err := gs.generalAPI.JobTagAPI.DeleteJobTag(ctx, jobTagID).Execute()
	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) AddMentorUserWay(ctx context.Context, userID, wayID string) error {
	response, err := gs.generalAPI.MentorUserWayAPI.CreateMentorUserWay(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateMentorUserWayPayload{
		UserUuid: userID,
		WayUuid:  wayID,
	}).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) DeleteMentorUserWay(ctx context.Context, userID, wayID string) error {
	response, err := gs.generalAPI.MentorUserWayAPI.DeleteMentorUserWay(ctx).Request(openapiGeneral.MwserverInternalSchemasDeleteMentorUserWayPayload{
		UserUuid: userID,
		WayUuid:  wayID,
	}).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreateMetric(ctx context.Context, payload *schemas.CreateMetricPayload) (*openapiGeneral.MwserverInternalSchemasMetricResponse, error) {
	metric, response, err := gs.generalAPI.MetricAPI.CreateMetric(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateMetricPayload{
		Description:    payload.Description,
		DoneDate:       payload.DoneDate,
		EstimationTime: payload.MetricEstimation,
		IsDone:         payload.IsDone,
		WayUuid:        payload.WayUuid,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return metric, nil
}

type UpdateMetricParams struct {
	MetricID         string
	Description      *string
	IsDone           *bool
	MetricEstimation *int32
}

func (gs *GeneralService) UpdateMetric(ctx context.Context, params *UpdateMetricParams) (*openapiGeneral.MwserverInternalSchemasMetricResponse, error) {
	metric, response, err := gs.generalAPI.MetricAPI.UpdateMetric(ctx, params.MetricID).Request(openapiGeneral.MwserverInternalSchemasUpdateMetricPayload{
		Description:    params.Description,
		EstimationTime: params.MetricEstimation,
		IsDone:         params.IsDone,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return metric, nil
}

func (gs *GeneralService) DeleteMetricById(ctx context.Context, metricID string) error {
	response, err := gs.generalAPI.MetricAPI.DeleteMetric(ctx, metricID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreatePlan(ctx context.Context, payload *schemas.CreatePlanPayload) (*openapiGeneral.MwserverInternalSchemasPlanPopulatedResponse, error) {
	plan, response, err := gs.generalAPI.PlanAPI.CreatePlan(ctx).Request(openapiGeneral.MwserverInternalSchemasCreatePlanPayload{
		DayReportUuid: payload.DayReportUuid,
		Description:   payload.Description,
		IsDone:        payload.IsDone,
		OwnerUuid:     payload.OwnerUuid,
		Time:          payload.Time,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return plan, nil
}

type UpdatePlanParams struct {
	PlanID      string
	Description *string
	Time        *int32
	IsDone      *bool
}

func (gs *GeneralService) UpdatePlan(ctx context.Context, params *UpdatePlanParams) (*openapiGeneral.MwserverInternalSchemasPlanPopulatedResponse, error) {
	plan, response, err := gs.generalAPI.PlanAPI.UpdatePlan(ctx, params.PlanID).Request(openapiGeneral.MwserverInternalSchemasUpdatePlanPayload{
		Description: params.Description,
		IsDone:      params.IsDone,
		Time:        params.Time,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return plan, nil
}

func (gs *GeneralService) DeletePlanById(ctx context.Context, planID string) error {
	response, err := gs.generalAPI.PlanAPI.DeletePlan(ctx, planID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreatePlanJobTag(ctx context.Context, payload *schemas.CreatePlanJobTagPayload) error {
	response, err := gs.generalAPI.PlanJobTagAPI.CreatePlanJobTag(ctx).Request(openapiGeneral.MwserverInternalSchemasCreatePlanJobTagPayload{
		JobTagUuid: payload.JobTagUuid,
		PlanUuid:   payload.PlanUuid,
	}).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil

}

func (gs *GeneralService) DeletePlanJobTagById(ctx context.Context, planID, jobTagID string) error {
	response, err := gs.generalAPI.PlanJobTagAPI.DeletePlanJobTag(ctx, jobTagID, planID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreateProblem(ctx context.Context, payload *schemas.CreateProblemPayload) (*openapiGeneral.MwserverInternalSchemasProblemPopulatedResponse, error) {
	problem, response, err := gs.generalAPI.ProblemAPI.CreateProblem(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateProblemPayload{
		DayReportUuid: payload.DayReportUuid,
		Description:   payload.Description,
		IsDone:        payload.IsDone,
		OwnerUuid:     payload.OwnerUuid,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return problem, nil
}

type UpdateProblemParams struct {
	ProblemID   string
	Description *string
	IsDone      *bool
}

func (gs *GeneralService) UpdateProblem(ctx context.Context, params *UpdateProblemParams) (*openapiGeneral.MwserverInternalSchemasProblemPopulatedResponse, error) {
	problem, response, err := gs.generalAPI.ProblemAPI.UpdateProblem(ctx, params.ProblemID).Request(openapiGeneral.MwserverInternalSchemasUpdateProblemPayload{
		Description: params.Description,
		IsDone:      params.IsDone,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return problem, nil
}

func (gs *GeneralService) DeleteProblemById(ctx context.Context, problemID string) error {
	response, err := gs.generalAPI.ProblemAPI.DeleteProblem(ctx, problemID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) CreateProject(ctx context.Context, payload *schemas.CreateProjectPayload) (*openapiGeneral.MwserverInternalSchemasProjectPopulatedResponse, error) {
	project, response, err := gs.generalAPI.ProjectAPI.CreateProject(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateProjectPayload{
		Name:    payload.Name,
		OwnerId: payload.OwnerID,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return project, nil
}

type UpdateProjectParams struct {
	ID        string
	Name      *string
	IsPrivate *bool
}

func (gs *GeneralService) UpdateProject(ctx context.Context, params *UpdateProjectParams) (*openapiGeneral.MwserverInternalSchemasProjectPopulatedResponse, error) {
	project, response, err := gs.generalAPI.ProjectAPI.UpdateProject(ctx, params.ID).Request(openapiGeneral.MwserverInternalSchemasUpdateProjectPayload{
		IsPrivate: params.IsPrivate,
		Name:      params.Name,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return project, nil
}

func (gs *GeneralService) GetProjectByID(ctx context.Context, projectID string) (*openapiGeneral.MwserverInternalSchemasProjectPopulatedResponse, error) {
	project, response, err := gs.generalAPI.ProjectAPI.GetProject(ctx, projectID).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return project, nil
}

func (gs *GeneralService) DeleteProjectByID(ctx context.Context, projectID string) error {
	response, err := gs.generalAPI.ProjectAPI.DeleteProject(ctx, projectID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}
	return nil
}

func (gs *GeneralService) CreateToUserMentoringRequest(ctx context.Context, payload *schemas.CreateToUserMentoringRequestPayload) (*openapiGeneral.MwserverInternalSchemasToUserMentoringRequestResponse, error) {
	userMentoringRequest, response, err := gs.generalAPI.ToUserMentoringRequestAPI.CreateUserMentoringRequest(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateToUserMentoringRequestPayload{
		UserUuid: payload.UserUuid,
		WayUuid:  payload.WayUuid,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return userMentoringRequest, nil
}

func (gs *GeneralService) DeleteToUserMentoringRequestById(ctx context.Context, userID, wayID string) error {
	response, err := gs.generalAPI.ToUserMentoringRequestAPI.DeleteToUserMentoringRequest(ctx, userID, wayID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

type UpdateUserParams struct {
	UserID      string
	Name        *string
	Description *string
	ImageUrl    *string
	IsMentor    *bool
}

func (gs *GeneralService) UpdateUser(ctx context.Context, params *UpdateUserParams) (*openapiGeneral.MwserverInternalSchemasUserPlainResponse, error) {
	user, response, err := gs.generalAPI.UserAPI.UpdateUser(ctx, params.UserID).Request(openapiGeneral.MwserverInternalSchemasUpdateUserPayload{
		Description: params.Description,
		ImageUrl:    params.ImageUrl,
		IsMentor:    params.IsMentor,
		Name:        params.Name,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return user, nil
}

type GetAllUsersParams struct {
	MentorStatus string
	UserName     string
	UserEmail    string
	Page         int
	Limit        int
}

func (gs *GeneralService) GetAllUsers(ctx context.Context, params *GetAllUsersParams) (*openapiGeneral.MwserverInternalSchemasGetAllUsersResponse, error) {
	users, response, err := gs.generalAPI.UserAPI.GetAllUsers(ctx).
		MentorStatus(params.MentorStatus).
		Name(params.UserName).
		Email(params.UserEmail).
		Page(int32(params.Page)).
		Limit(int32(params.Limit)).
		Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return users, nil
}

func (gs *GeneralService) GetUsersByIDs(ctx context.Context, userIDs []string) ([]schemas.GetUsersByIDsResponse, error) {
	userRaw, response, err := gs.generalAPI.UserAPI.GetUsersByIds(ctx).Request(userIDs).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	users := make([]schemas.GetUsersByIDsResponse, len(userRaw))
	for _, dsResponse := range userRaw {
		users = append(users, schemas.GetUsersByIDsResponse{
			UserID:   dsResponse.UserId,
			Name:     dsResponse.Name,
			ImageURL: dsResponse.ImageUrl,
		})
	}

	return users, nil
}

type CreateUserParams struct {
	Name        string
	Email       string
	Description string
	CreatedAt   time.Time
	ImageUrl    string
	IsMentor    bool
}

func (gs *GeneralService) FindOrCreateUserByEmail(ctx context.Context, params *CreateUserParams) (*schemas.UserPopulatedResponse, error) {

	return nil, nil
}

func (gs *GeneralService) CreateUser(ctx context.Context, params *CreateUserParams) (*schemas.UserPlainResponse, error) {
	return nil, nil
}

type dbWay struct {
	Uuid                uuid.UUID
	Name                string
	OwnerUuid           uuid.UUID
	GoalDescription     string
	UpdatedAt           time.Time
	CreatedAt           time.Time
	EstimationTime      int32
	CopiedFromWayUuid   uuid.UUID
	ProjectUuid         uuid.UUID
	IsCompleted         bool
	IsPrivate           bool
	WayMetricsTotal     int64
	WayMetricsDone      int64
	WayFavoriteForUsers int64
	WayDayReportsAmount int64
	ChildrenUuids       []string
}

func (gs *GeneralService) GetPopulatedUserById(ctx context.Context, userUuid uuid.UUID) (*openapiGeneral.MwserverInternalSchemasUserPopulatedResponse, error) {
	user, response, err := gs.generalAPI.UserAPI.GetUserByUuid(ctx, userUuid.String()).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return user, nil
}

func mapWayCollection(collection openapiGeneral.MwserverInternalSchemasWayCollectionPopulatedResponse) schemas.WayCollectionPopulatedResponse {
	return schemas.WayCollectionPopulatedResponse{
		Uuid:      collection.Uuid,
		Name:      collection.Name,
		Ways:      lo.Map(collection.Ways, mapWayPlainResponse),
		CreatedAt: collection.CreatedAt,
		UpdatedAt: collection.UpdatedAt,
		OwnerUuid: collection.OwnerUuid,
		Type:      collection.Type,
	}
}

func mapWayPlainResponse(way openapiGeneral.MwserverInternalSchemasWayPlainResponse, _ int) schemas.WayPlainResponse {
	return schemas.WayPlainResponse{
		Uuid:              way.Uuid,
		Name:              way.Name,
		GoalDescription:   way.GoalDescription,
		UpdatedAt:         way.UpdatedAt,
		CreatedAt:         way.CreatedAt,
		EstimationTime:    way.EstimationTime,
		IsCompleted:       way.IsCompleted,
		Owner:             mapUserPlainResponse(way.Owner, 1),
		CopiedFromWayUuid: way.CopiedFromWayUuid.Get(),
		ProjectUuid:       way.ProjectUuid.Get(),
		IsPrivate:         way.IsPrivate,
		FavoriteForUsers:  way.FavoriteForUsers,
		DayReportsAmount:  way.DayReportsAmount,
		Mentors:           lo.Map(way.Mentors, mapUserPlainResponse),
		WayTags:           lo.Map(way.WayTags, mapWayTagResponse),
		MetricsDone:       way.MetricsDone,
		MetricsTotal:      way.MetricsTotal,
		ChildrenUuids:     way.ChildrenUuids,
	}
}

func mapUserPlainResponse(user openapiGeneral.MwserverInternalSchemasUserPlainResponse, _ int) schemas.UserPlainResponse {
	return schemas.UserPlainResponse{
		Uuid:        user.Uuid,
		Name:        user.Name,
		Email:       user.Email,
		Description: user.Description,
		CreatedAt:   user.CreatedAt,
		ImageUrl:    user.ImageUrl,
		IsMentor:    user.IsMentor,
	}
}

func mapUserTagResponse(tag openapiGeneral.MwserverInternalSchemasUserTagResponse, _ int) schemas.UserTagResponse {
	return schemas.UserTagResponse{
		Uuid: tag.Uuid,
		Name: tag.Name,
	}
}

func mapWayTagResponse(tag openapiGeneral.MwserverInternalSchemasWayTagResponse, _ int) schemas.WayTagResponse {
	return schemas.WayTagResponse{
		Uuid: tag.Uuid,
		Name: tag.Name,
	}
}

func mapProjectPlainResponse(project openapiGeneral.MwserverInternalSchemasProjectPlainResponse, _ int) schemas.ProjectPlainResponse {
	return schemas.ProjectPlainResponse{
		ID:        project.Id,
		Name:      project.Name,
		UserIDs:   project.UserIds,
		IsPrivate: project.IsPrivate,
	}
}

//
//func (us *GeneralService) convertDbWaysToPlainWays(ctx context.Context, dbWays []dbWay) []schemas.WayPlainResponse {
//	return nil
//}
//
////
//func (us *GeneralService) dbCollectionWaysToDbWays(rawWay []db.GetWaysByCollectionIdRow) []dbWay {
//	return nil
//}
//
//func (us *GeneralService) dbMentoringWaysToDbWays(rawWay []db.GetMentoringWaysByMentorIdRow) []dbWay {
//	return nil
//}
//
//func (us *GeneralService) dbFavoriteWaysToDbWays(rawWay []db.GetFavoriteWaysByUserIdRow) []dbWay {
//	return nil
//}

func (gs *GeneralService) GetPlainUserWithInfoByIDs(ctx context.Context, projectID string) ([]schemas.UserPlainResponseWithInfo, error) {
	usersRaw, response, err := gs.generalAPI.ProjectAPI.GetProject(ctx, projectID).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	users := make([]schemas.UserPlainResponseWithInfo, len(usersRaw.Users))

	for i, user := range usersRaw.Users {
		tags := make([]schemas.UserTagResponse, len(user.Tags))
		for j, tag := range user.Tags {
			tags[j] = schemas.UserTagResponse{
				Uuid: tag.Uuid,
				Name: tag.Name,
			}
		}

		users[i] = schemas.UserPlainResponseWithInfo{
			Uuid:             user.Uuid,
			Name:             user.Name,
			Email:            user.Email,
			Description:      user.Description,
			CreatedAt:        user.CreatedAt,
			ImageUrl:         user.ImageUrl,
			IsMentor:         user.IsMentor,
			FavoriteForUsers: user.FavoriteForUsers,
			FavoriteWays:     user.FavoriteWays,
			MentoringWays:    user.MentoringWays,
			OwnWays:          user.OwnWays,
			Tags:             tags,
		}
	}

	return users, nil
}

func (gs *GeneralService) CreateUserProject(ctx context.Context, userID, projectID string) error {
	response, err := gs.generalAPI.UserProjectAPI.CreateUserProject(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateUserProjectPayload{
		ProjectId: projectID,
		UserId:    userID,
	}).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) DeleteUserProject(ctx context.Context, projectID, userID string) error {
	response, err := gs.generalAPI.UserProjectAPI.DeleteUserProject(ctx, projectID, userID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) AddUserTagByName(ctx context.Context, payload *schemas.CreateUserTagPayload) (*openapiGeneral.MwserverInternalSchemasUserTagResponse, error) {
	userTag, response, err := gs.generalAPI.UserTagAPI.CreateUserTag(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateUserTagPayload{
		Name:      payload.Name,
		OwnerUuid: payload.OwnerUuid,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return userTag, nil
}

func (gs *GeneralService) DeleteUserTagByFromUserByTag(ctx context.Context, userTagID, userID string) error {
	response, err := gs.generalAPI.UserTagAPI.DeleteUserTag(ctx, userTagID, userID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

type GetPopulatedWayByIdParams struct {
	WayUuid              uuid.UUID
	CurrentChildrenDepth int32
}

func (gs *GeneralService) GetPlainWayById(ctx context.Context, wayUUID uuid.UUID) (*schemas.WayPlainResponse, error) {
	wayRaw, response, err := gs.generalAPI.WayAPI.GetWayByUuid(ctx, wayUUID.String()).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	owner := mapOwner(wayRaw.Owner)
	mentors := mapMentors(wayRaw.Mentors)
	wayTags := mapWayTags(wayRaw.WayTags)

	var metricsDone int32 = 0
	var metricsTotal int32 = 0

	for _, metric := range wayRaw.Metrics {
		if metric.IsDone {
			metricsDone++
		}
		metricsTotal += metric.EstimationTime
	}

	childrenUuids := make([]string, len(wayRaw.Children))
	for i, child := range wayRaw.Children {
		childrenUuids[i] = child.Uuid
	}

	way := &schemas.WayPlainResponse{
		Uuid:              wayRaw.Uuid,
		Name:              wayRaw.Name,
		GoalDescription:   wayRaw.GoalDescription,
		UpdatedAt:         wayRaw.UpdatedAt,
		CreatedAt:         wayRaw.CreatedAt,
		EstimationTime:    wayRaw.EstimationTime,
		IsCompleted:       wayRaw.IsCompleted,
		Owner:             owner,
		CopiedFromWayUuid: wayRaw.CopiedFromWayUuid.Get(),
		ProjectUuid:       wayRaw.ProjectUuid.Get(),
		IsPrivate:         wayRaw.IsPrivate,
		FavoriteForUsers:  wayRaw.FavoriteForUsersAmount,
		Mentors:           mentors,
		WayTags:           wayTags,
		MetricsDone:       metricsDone,
		MetricsTotal:      metricsTotal,
		ChildrenUuids:     childrenUuids,
	}

	return way, nil
}

func (gs *GeneralService) CreateWay(ctx context.Context, payload *schemas.CreateWayPayload) (*openapiGeneral.MwserverInternalSchemasWayPlainResponse, error) {
	var CopiedFromWayID, ProjectID openapiGeneral.NullableString

	CopiedFromWayID.Set(payload.CopiedFromWayID)
	ProjectID.Set(payload.ProjectID)

	way, response, err := gs.generalAPI.WayAPI.CreateWay(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateWayPayload{
		CopiedFromWayId: CopiedFromWayID,
		EstimationTime:  payload.EstimationTime,
		GoalDescription: payload.GoalDescription,
		IsCompleted:     payload.IsCompleted,
		IsPrivate:       payload.IsPrivate,
		Name:            payload.Name,
		OwnerId:         payload.OwnerID,
		ProjectId:       ProjectID,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return way, nil
}

func mapOwner(ownerRaw openapiGeneral.MwserverInternalSchemasUserPlainResponse) schemas.UserPlainResponse {
	return schemas.UserPlainResponse{
		Uuid:        ownerRaw.Uuid,
		Name:        ownerRaw.Name,
		Email:       ownerRaw.Email,
		Description: ownerRaw.Description,
		CreatedAt:   ownerRaw.CreatedAt,
		ImageUrl:    ownerRaw.ImageUrl,
		IsMentor:    ownerRaw.IsMentor,
	}
}

func mapMentors(mentorsRaw []openapiGeneral.MwserverInternalSchemasUserPlainResponse) []schemas.UserPlainResponse {
	mentors := make([]schemas.UserPlainResponse, len(mentorsRaw))
	for i, mentor := range mentorsRaw {
		mentors[i] = schemas.UserPlainResponse{
			Uuid:        mentor.Uuid,
			Name:        mentor.Name,
			Email:       mentor.Email,
			Description: mentor.Description,
			CreatedAt:   mentor.CreatedAt,
			ImageUrl:    mentor.ImageUrl,
			IsMentor:    mentor.IsMentor,
		}
	}
	return mentors
}

func mapWayTags(tagsRaw []openapiGeneral.MwserverInternalSchemasWayTagResponse) []schemas.WayTagResponse {
	wayTags := make([]schemas.WayTagResponse, len(tagsRaw))
	for i, tag := range tagsRaw {
		wayTags[i] = schemas.WayTagResponse{
			Uuid: tag.Uuid,
			Name: tag.Name,
		}
	}
	return wayTags
}

type UpdateWayParams struct {
	WayID           string
	Name            string
	GoalDescription string
	EstimationTime  int32
	IsPrivate       bool
	IsCompleted     bool
}

func (gs *GeneralService) UpdateWay(ctx context.Context, params *UpdateWayParams) (*openapiGeneral.MwserverInternalSchemasWayPlainResponse, error) {
	way, response, err := gs.generalAPI.WayAPI.UpdateWay(ctx, params.WayID).Request(openapiGeneral.MwserverInternalSchemasUpdateWayPayload{
		EstimationTime:  &params.EstimationTime,
		GoalDescription: &params.GoalDescription,
		IsCompleted:     &params.IsCompleted,
		IsPrivate:       &params.IsPrivate,
		Name:            &params.Name,
	}).Execute()
	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return way, nil
}

type GetAllWaysParams struct {
	Status                 string
	WayName                string
	ReqMinDayReportsAmount int
	Page                   int
	Limit                  int
}

func (gs *GeneralService) GetAllWays(ctx context.Context, params *GetAllWaysParams) (*openapiGeneral.MwserverInternalSchemasGetAllWaysResponse, error) {
	ways, response, err := gs.generalAPI.WayAPI.GetAllWays(ctx).
		WayName(params.WayName).
		MinDayReportsAmount(int32(params.ReqMinDayReportsAmount)).
		Status(params.Status).
		Page(int32(params.Page)).
		Limit(int32(params.Limit)).
		Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return ways, nil
}

func mapWayPlainRes(wayRaw openapiGeneral.MwserverInternalSchemasWayPlainResponse) schemas.WayPlainResponse {
	return schemas.WayPlainResponse{
		Uuid:              wayRaw.Uuid,
		Name:              wayRaw.Name,
		GoalDescription:   wayRaw.GoalDescription,
		UpdatedAt:         wayRaw.UpdatedAt,
		CreatedAt:         wayRaw.CreatedAt,
		EstimationTime:    wayRaw.EstimationTime,
		IsCompleted:       wayRaw.IsCompleted,
		Owner:             mapOwner(wayRaw.Owner),
		CopiedFromWayUuid: wayRaw.CopiedFromWayUuid.Get(),
		ProjectUuid:       wayRaw.ProjectUuid.Get(),
		IsPrivate:         wayRaw.IsPrivate,
		FavoriteForUsers:  wayRaw.FavoriteForUsers,
		DayReportsAmount:  wayRaw.DayReportsAmount,
		Mentors:           mapMentors(wayRaw.Mentors),
		WayTags:           mapWayTags(wayRaw.WayTags),
		MetricsDone:       wayRaw.MetricsDone,
		MetricsTotal:      wayRaw.MetricsTotal,
		ChildrenUuids:     wayRaw.ChildrenUuids,
	}
}
func (gs *GeneralService) DeleteWayById(ctx *gin.Context, wayID string) error {
	response, err := gs.generalAPI.WayAPI.DeleteWay(ctx, wayID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) GetChildrenWayIDs(ctx context.Context, wayID uuid.UUID, maxDepth int) ([]uuid.UUID, error) {
	var collectChildren func(ctx context.Context, wayID uuid.UUID, currentDepth int) ([]uuid.UUID, error)
	collectChildren = func(ctx context.Context, wayID uuid.UUID, currentDepth int) ([]uuid.UUID, error) {
		if currentDepth >= maxDepth {
			return nil, nil
		}

		wayRaw, response, err := gs.generalAPI.WayAPI.GetWayByUuid(ctx, wayID.String()).Execute()
		if err != nil {
			return nil, utils.ExtractErrorMessageFromResponse(response)
		}

		children := make([]uuid.UUID, len(wayRaw.Children))
		for i, child := range wayRaw.Children {
			childUUID, parseErr := uuid.Parse(child.GetUuid())
			if parseErr != nil {
				return nil, fmt.Errorf("failed to parse child UUID: %w", parseErr)
			}
			children[i] = childUUID
		}

		for _, childID := range children {
			subChildren, err := collectChildren(ctx, childID, currentDepth+1)
			if err != nil {
				return nil, err
			}
			children = append(children, subChildren...)
		}

		return children, nil
	}

	return collectChildren(ctx, wayID, 0)
}

func (gs *GeneralService) GetWayById(ctx context.Context, wayUUID string) (*openapiGeneral.MwserverInternalSchemasWayPopulatedResponse, error) {
	way, response, err := gs.generalAPI.WayAPI.GetWayByUuid(ctx, wayUUID).Execute()
	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}
	return way, nil
}

func (gs *GeneralService) CreateWayCollection(ctx context.Context, payload *schemas.CreateWayCollectionPayload) (*openapiGeneral.MwserverInternalSchemasWayCollectionPopulatedResponse, error) {
	wayCollection, response, err := gs.generalAPI.WayCollectionAPI.CreateWayCollection(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateWayCollectionPayload{
		Name:      payload.Name,
		OwnerUuid: payload.OwnerUuid,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return wayCollection, nil
}

func (gs *GeneralService) UpdateWayCollection(ctx context.Context, wayCollectionID, wayCollectionName string) (*openapiGeneral.MwserverInternalSchemasWayCollectionPlainResponse, error) {
	wayCollection, response, err := gs.generalAPI.WayCollectionAPI.UpdateWayCollection(ctx, wayCollectionID).Request(openapiGeneral.MwserverInternalSchemasUpdateWayCollectionPayload{
		Name: &wayCollectionName,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return wayCollection, nil
}

func (gs *GeneralService) DeleteWayCollectionById(ctx context.Context, wayCollectionID string) error {
	response, err := gs.generalAPI.WayCollectionAPI.DeleteWayCollection(ctx, wayCollectionID).Execute()
	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}
	return nil
}

func (gs *GeneralService) CreateWayCollectionWay(ctx context.Context, payload *schemas.CreateWayCollectionWay) (*openapiGeneral.MwserverInternalSchemasWayCollectionWayResponse, error) {
	wayCollectionWay, response, err := gs.generalAPI.WayCollectionWayAPI.CreateWayCollectionWay(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateWayCollectionWay{
		WayUuid:           payload.WayCollectionUuid,
		WayCollectionUuid: payload.WayCollectionUuid,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return wayCollectionWay, nil
}

func (gs *GeneralService) DeleteWayCollectionWayById(ctx context.Context, wayID, wayCollectionID string) error {
	response, err := gs.generalAPI.WayCollectionWayAPI.DeleteWayCollectionWay(ctx, wayCollectionID, wayID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

type GetWayStatisticsTriplePeriodParams struct {
	WayUUIDs       []uuid.UUID
	TotalStartDate time.Time
	EndDate        time.Time
}

func (gs *GeneralService) GetWayStatisticsById(ctx context.Context, wayUUID string) (*openapiGeneral.MwserverInternalSchemasWayStatisticsTriplePeriod, error) {
	wayStatistics, response, err := gs.generalAPI.WayAPI.GetWayStatisticsByUuid(ctx, wayUUID).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return wayStatistics, nil
}

func (gs *GeneralService) AddWayTagToWay(ctx context.Context, name string, wayID string) (*openapiGeneral.MwserverInternalSchemasWayTagResponse, error) {
	wayTag, response, err := gs.generalAPI.WayTagAPI.CreateWayTag(ctx).Request(openapiGeneral.MwserverInternalSchemasCreateWayTagPayload{
		WayUuid: wayID,
		Name:    name,
	}).Execute()

	if err != nil {
		return nil, utils.ExtractErrorMessageFromResponse(response)
	}

	return wayTag, nil
}

func (gs *GeneralService) DeleteWayTagFromWayByTagID(ctx context.Context, wayTagID string, wayID string) error {
	response, err := gs.generalAPI.WayTagAPI.DeleteWayTag(ctx, wayTagID, wayID).Execute()

	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}

	return nil
}

func (gs *GeneralService) GeneralHealthCheck(ctx context.Context) error {
	response, err := gs.generalAPI.HealthAPI.GeneralHealthCheck(ctx).Execute()
	if err != nil {
		return utils.ExtractErrorMessageFromResponse(response)
	}
	return nil
}
