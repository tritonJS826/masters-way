package services

import (
	"mw-general-bff/internal/config"
	"mw-general-bff/internal/openapi"
	pb "mw-general-bff/pkg/grpcAutoGenerated/notification"
	"mw-general-bff/pkg/grpcAutoGenerated/training"

	"google.golang.org/grpc"
)

type Service struct {
	AuthService         *AuthService
	GeneralService      *GeneralService
	MailService         *MailService
	StorageService      *StorageService
	NotificationService *NotificationService
	ChatService         *ChatService
	TrainingService     *TrainingService
}

func NewService(config *config.Config, notificationConfig, trainingConfig *grpc.ClientConn) *Service {
	var generalApi = openapi.MakeGeneralAPIClient(config)
	var storageApi = openapi.MakeStorageAPIClient(config)
	var mailApi = openapi.MakeMailAPIClient(config)
	var chatApi = openapi.MakeChatAPIClient(config)

	notificationGRPC := pb.NewNotificationServiceClient(notificationConfig)
	notificationSettingGRPC := pb.NewNotificationSettingServiceClient(notificationConfig)

	trainingGRPC := training.NewTrainingServiceClient(trainingConfig)
	topicGRPC := training.NewTopicsServiceClient(trainingConfig)
	theoryMaterialGRPC := training.NewTheoryMaterialServiceClient(trainingConfig)
	practiceMaterialGRPC := training.NewPracticeMaterialServiceClient(trainingConfig)
	trainingMessageToAiGRPC := training.NewTrainingMessageToAIServiceClient(trainingConfig)

	return &Service{
		AuthService:         newAuthService(generalApi),
		GeneralService:      newGeneralService(generalApi),
		MailService:         newMailService(mailApi),
		StorageService:      newStorageService(storageApi),
		NotificationService: newNotificationService(notificationGRPC, notificationSettingGRPC),
		ChatService:         newChatService(chatApi, config),
		TrainingService:     newTrainingService(trainingGRPC, topicGRPC, theoryMaterialGRPC, practiceMaterialGRPC, trainingMessageToAiGRPC),
	}
}
