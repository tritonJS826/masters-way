package services

import (
	"mw-general-bff/internal/config"
	"mw-general-bff/internal/openapi"
	pb "mw-general-bff/pkg/grpcAutoGenerated/notification"
	"mw-general-bff/pkg/grpcAutoGenerated/training"

	"google.golang.org/grpc"
)

type Service struct {
	AuthService          *AuthService
	GeneralService       *GeneralService
	MailService          *MailService
	StorageService       *StorageService
	NotificationService  *NotificationService
	ChatService          *ChatService
	ChatWebSocketService *ChatWebSocketService
	TestWebSocketService *TestWebsocketService
	TrainingService      *TrainingService
}

func NewService(config *config.Config, notificationConfig, trainingConfig *grpc.ClientConn) *Service {
	var generalApi = openapi.MakeGeneralAPIClient(config)
	var storageApi = openapi.MakeStorageAPIClient(config)
	var mailApi = openapi.MakeMailAPIClient(config)
	var chatApi = openapi.MakeChatAPIClient(config)
	var chatWebSocketApi = openapi.MakeChatWebsocketAPIClient(config)
	var testWebSocketApi = openapi.MakeTestWebsocketAPIClient(config)

	notificationGRPC := pb.NewNotificationServiceClient(notificationConfig)
	notificationSettingGRPC := pb.NewNotificationSettingServiceClient(notificationConfig)

	trainingGRPC := training.NewTrainingServiceClient(trainingConfig)
	topicGRPC := training.NewTopicsServiceClient(trainingConfig)
	theoryMaterialGRPC := training.NewTheoryMaterialServiceClient(trainingConfig)
	practiceMaterialGRPC := training.NewPracticeMaterialServiceClient(trainingConfig)
	trainingMessageToAiGRPC := training.NewTrainingMessageToAIServiceClient(trainingConfig)

	testGRPC := training.NewTestServiceClient(trainingConfig)
	questionGRPC := training.NewQuestionServiceClient(trainingConfig)
	questionResultsGRPC := training.NewQuestionResultsServiceClient(trainingConfig)
	testSessionResultsGRPC := training.NewTestSessionResultsServiceClient(trainingConfig)

	return &Service{
		AuthService:          newAuthService(generalApi),
		GeneralService:       newGeneralService(generalApi),
		MailService:          newMailService(mailApi),
		StorageService:       newStorageService(storageApi),
		NotificationService:  newNotificationService(notificationGRPC, notificationSettingGRPC),
		ChatService:          newChatService(chatApi, config),
		ChatWebSocketService: newChatWebSocketService(chatWebSocketApi),
		TestWebSocketService: newTestWebsocketService(testWebSocketApi),
		TrainingService:      newTrainingService(trainingGRPC, testGRPC, questionGRPC, questionResultsGRPC, testSessionResultsGRPC, topicGRPC, theoryMaterialGRPC, practiceMaterialGRPC, trainingMessageToAiGRPC),
	}
}
