package services

import (
	"context"
	openapiNotification "mw-notification-bff/apiAutogenerated/mw-notification"
)

type NotificationService struct {
	notificationAPI *openapiNotification.APIClient
}

func NewNotificationService(notificationAPI *openapiNotification.APIClient) *NotificationService {
	return &NotificationService{notificationAPI}
}

func (ns *NotificationService) GetNotificationList(ctx context.Context) (*openapiNotification.SchemasGetNotificationListResponse, error) {
	notificationList, _, err := ns.notificationAPI.NotificationAPI.GetNotificationList(ctx).Execute()
	if err != nil {
		return nil, err
	}

	return notificationList, nil
}

func (ns *NotificationService) UpdateNotification(ctx context.Context, notificationID string, isRead bool) (*openapiNotification.SchemasNotificationResponse, error) {
	request := openapiNotification.SchemasUpdateNotificationPayload{
		IsRead: isRead,
	}
	notification, _, err := ns.notificationAPI.NotificationAPI.UpdateNotification(ctx, notificationID).Request(request).Execute()
	if err != nil {
		return nil, err
	}

	return notification, nil
}

func (ns *NotificationService) GetEnabledNotificationList(ctx context.Context) (*openapiNotification.SchemasGetEnabledNotificationListResponse, error) {
	enabledNotificationList, _, err := ns.notificationAPI.EnabledNotificationAPI.GetEnabledNotificationList(ctx).Execute()
	if err != nil {
		return nil, err
	}

	return enabledNotificationList, nil
}

func (ns *NotificationService) UpdateEnabledNotification(ctx context.Context, enabledNotificationID string, isEnabled bool) (*openapiNotification.SchemasEnabledNotificationResponse, error) {
	request := openapiNotification.SchemasUpdateEnabledNotificationPayload{
		IsEnabled: isEnabled,
	}
	enabledNotification, _, err := ns.notificationAPI.EnabledNotificationAPI.UpdateEnabledNotification(ctx, enabledNotificationID).Request(request).Execute()
	if err != nil {
		return nil, err
	}

	return enabledNotification, nil
}
