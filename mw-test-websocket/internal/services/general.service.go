package services

import (
	"context"
	"mw-test-websocket/internal/schemas"

	openapi "mw-test-websocket/apiAutogenerated/general"

	"github.com/samber/lo"
)

type GeneralService struct {
	generalAPI *openapi.APIClient
}

func NewGeneralService(generalAPI *openapi.APIClient) *GeneralService {
	return &GeneralService{generalAPI}
}

func (gs *GeneralService) GetUserByIds(ctx context.Context, userIDs []string) ([]schemas.ShortUser, error) {
	chatUsersData, _, err := gs.generalAPI.UserAPI.GetUsersByIds(ctx).Request(userIDs).Execute()
	if err != nil {
		return nil, err
	}

	shortUsers := lo.Map(chatUsersData, func(userData openapi.MwServerInternalSchemasShortUser, _ int) schemas.ShortUser {
		return schemas.ShortUser{
			UserID:   userData.UserId,
			Email:    userData.Email,
			Name:     userData.Name,
			ImageURL: userData.ImageUrl,
		}
	})

	return shortUsers, nil
}
