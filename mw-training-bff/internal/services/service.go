package services

import (
	"mw-training-bff/internal/config"
	"mw-training-bff/internal/openapi"
	pb "mw-training-bff/pkg/grpcAutogenerated/training"

	"google.golang.org/grpc"
)

type Service struct {
	GeneralService              *GeneralService
	TrainingTrainingTagService  *TrainingTrainingTagService
	TrainingStudentService      *TrainingStudentService
	TrainingMentorService       *TrainingMentorService
	TrainingService             *TrainingService
	TopicService                *TopicService
	TheoryMaterialService       *TheoryMaterialService
	PracticeMaterialService     *PracticeMaterialService
	FavoriteUserTrainingService *FavoriteUserTrainingService
	TestService                 *TestService
	TrainingTestService         *TrainingTestService
	SessionService              *SessionService
	QuestionService             *QuestionService
	QuestionResultsService      *QuestionResultService
	TestSessionResultsService   *TestSessionResultsService
}

func NewService(
	config *config.Config,
	conn *grpc.ClientConn,
) *Service {
	generalApi := openapi.MakeGeneralAPIClient(config)

	trainingTrainingTagGRPC := pb.NewTrainingTrainingTagServiceClient(conn)
	trainingStudentGRPC := pb.NewTrainingStudentServiceClient(conn)
	trainingMentorGRPC := pb.NewTrainingMentorServiceClient(conn)
	trainingGRPC := pb.NewTrainingServiceClient(conn)
	topicGRPC := pb.NewTopicsServiceClient(conn)
	theoryMaterialGRPC := pb.NewTheoryMaterialServiceClient(conn)
	practiceMaterialGRPC := pb.NewPracticeMaterialServiceClient(conn)
	favoriteUserTrainingGRPC := pb.NewFavoriteUsersTrainingsServiceClient(conn)
	testGRPC := pb.NewTestServiceClient(conn)
	trainingTestGRPC := pb.NewTrainingTestsServiceClient(conn)
	sessionGRPC := pb.NewSessionServiceClient(conn)
	questionGRPC := pb.NewQuestionServiceClient(conn)
	questionResultsGRPC := pb.NewQuestionResultsServiceClient(conn)
	testSessionResultsGRPC := pb.NewTestSessionResultsServiceClient(conn)

	return &Service{
		GeneralService:              NewGeneralService(generalApi),
		TrainingTrainingTagService:  NewTrainingTrainingTagService(trainingTrainingTagGRPC),
		TrainingStudentService:      NewTrainingStudentService(trainingStudentGRPC),
		TrainingMentorService:       NewTrainingMentorService(trainingMentorGRPC),
		TrainingService:             NewTrainingService(trainingGRPC, generalApi),
		TopicService:                NewTopicService(topicGRPC, generalApi),
		TheoryMaterialService:       NewTheoryMaterialService(theoryMaterialGRPC),
		PracticeMaterialService:     NewPracticeMaterialService(practiceMaterialGRPC),
		FavoriteUserTrainingService: NewFavoriteUserTrainingService(favoriteUserTrainingGRPC),
		TestService:                 NewTestService(testGRPC),
		TrainingTestService:         NewTrainingTestService(trainingTestGRPC),
		SessionService:              NewSessionService(sessionGRPC),
		QuestionService:             NewQuestionService(questionGRPC, generalApi),
		QuestionResultsService:      NewQuestionResultService(questionResultsGRPC, generalApi),
		TestSessionResultsService:   NewTestSessionResultsService(testSessionResultsGRPC),
	}
}

type PopulatedUser struct {
	UserID   string
	Name     string
	ImageURL string
}
