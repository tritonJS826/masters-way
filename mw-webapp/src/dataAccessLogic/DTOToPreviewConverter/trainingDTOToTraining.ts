import {MwTrainingBffInternalSchemasTopicTreeNode, MwTrainingBffInternalSchemasTraining} from "src/apiAutogenerated/training";
import {trainingTagDTOToTrainingTag} from "src/dataAccessLogic/DTOToPreviewConverter/trainingTagDTOToTrainingTag";
import {userPreviewDTOToUserPreview} from "src/dataAccessLogic/DTOToPreviewConverter/userPreviewDTOToUserPreview";
import {Training} from "src/model/businessModel/Training";
import {TopicPreview} from "src/model/businessModelPreview/TopicPreview";
import {arrayToHashMap} from "src/utils/arrayToHashMap";

/**
 * Map tree topics
 */
export const mapTreeTopicsPreview = (topicA: MwTrainingBffInternalSchemasTopicTreeNode): TopicPreview => {

  const mappedTopic = new TopicPreview({
    uuid: topicA.topic.uuid,
    name: topicA.topic.name,
    order: topicA.topic.order,
    parentUuid: topicA.topic.parentUuid,
    children: topicA.children.map(mapTreeTopicsPreview),
    createdAt: new Date(topicA.topic.createdAt),
    practiceMaterialAmount: topicA.topic.practiceMaterialAmount,
    theoryMaterialAmount: topicA.topic.theoryMaterialAmount,
    trainingUuid: topicA.topic.trainingUuid,
  });

  return mappedTopic;
};

/**
 * Convert {@link trainingDTO} to {@link Training}
 */
export const trainingDTOToTraining = (
  trainingDTO: MwTrainingBffInternalSchemasTraining,
): Training => {
  const mentors = trainingDTO.mentors.map(userPreviewDTOToUserPreview);

  return new Training({
    ...trainingDTO,
    trainingTags: trainingDTO.trainingTags.map(trainingTagDTOToTrainingTag),
    createdAt: new Date(trainingDTO.createdAt),
    updatedAt: new Date(trainingDTO.updatedAt),
    owner: userPreviewDTOToUserPreview(trainingDTO.owner),
    mentors: arrayToHashMap({keyField: "uuid", list: mentors}),
    topics: trainingDTO.topicsTree.map(mapTreeTopicsPreview),
  });
};
