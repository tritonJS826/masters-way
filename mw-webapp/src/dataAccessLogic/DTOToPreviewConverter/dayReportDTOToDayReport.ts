import {SchemasDayReportPopulatedResponse} from "src/apiAutogenerated/general";
import {commentDTOToComment} from "src/dataAccessLogic/DTOToPreviewConverter/commentDTOToComment";
import {jobDoneDTOToJobDone} from "src/dataAccessLogic/DTOToPreviewConverter/jobDoneDTOToJobDone";
import {planDTOToPlan} from "src/dataAccessLogic/DTOToPreviewConverter/planDTOToPlan";
import {problemDTOToProblem} from "src/dataAccessLogic/DTOToPreviewConverter/problemDTOToProblem";
import {DayReport} from "src/model/businessModel/DayReport";

/**
 * DayReport  converter params
 */
interface DayReportConverterParams {

  /**
   * DayReport DTO
   */
  dayReportDTO: SchemasDayReportPopulatedResponse;

  /**
   * Job's way name
   */
  wayName: string;

  /**
   *Job's way uuid
   */
  wayUuid: string;
}

/**
 * Convert {@link DayReportDTO} to {@link DayReport}
 */
export const dayReportDTOToDayReport = (params: DayReportConverterParams): DayReport => {
  const plans = params.dayReportDTO.plans.map(plan => planDTOToPlan({
    planDTO: plan,
    wayName: params.wayName,
    wayUuid: params.wayUuid,
  }),
  );

  const jobsDone = params.dayReportDTO.jobsDone.map(job => jobDoneDTOToJobDone({
    jobDoneDTO: job,
    wayName: params.wayName,
    wayUuid: params.wayUuid,
  }),
  );

  const problems = params.dayReportDTO.problems.map(problem => problemDTOToProblem({
    problemDTO: problem,
    wayName: params.wayName,
    wayUuid: params.wayUuid,
  }),
  );

  const comments = params.dayReportDTO.comments.map(comment => commentDTOToComment({
    commentDTO: comment,
    wayName: params.wayName,
    wayUuid: params.wayUuid,
  }),
  );

  return new DayReport({
    ...params.dayReportDTO,
    createdAt: new Date(params.dayReportDTO.createdAt),
    updatedAt: new Date(params.dayReportDTO.updatedAt),
    jobsDone,
    plans,
    problems,
    comments,
  });
};
