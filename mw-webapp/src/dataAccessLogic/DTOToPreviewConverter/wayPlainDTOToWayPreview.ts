import {SchemasWayPlainResponse} from "src/apiAutogenerated";
import {getWayStatus, WayStatus} from "src/logic/waysTable/wayStatus";
import {UserPlain} from "src/model/businessModel/User";
import {WayPreview} from "src/model/businessModelPreview/WayPreview";

/**
 * Convert {@link SchemasWayPlainResponse} to {@link WayPreview}
 */
export const wayPlainDTOToWayPreview = (wayDTO: SchemasWayPlainResponse): WayPreview => {
  const status = getWayStatus({
    status: wayDTO.isCompleted ? WayStatus.completed : null,
    lastUpdate: new Date(wayDTO.updatedAt),
  });

  const mentors = wayDTO.mentors.map((mentor) => new UserPlain({
    ...mentor,
    createdAt: new Date(mentor.createdAt),
  }));

  return new WayPreview({
    ...wayDTO,
    status,
    createdAt: new Date(wayDTO.createdAt),
    lastUpdate: new Date(wayDTO.updatedAt),
    mentors,
    owner: new UserPlain({
      ...wayDTO.owner,
      createdAt: new Date(wayDTO.owner.createdAt),
    }),
  });
};
