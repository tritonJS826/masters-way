import {wayToWayDTOPartial} from "src/dataAccessLogic/BusinessToDTOConverter/wayToWayDTOPartial";
import {projectDTOToProject} from "src/dataAccessLogic/DTOToPreviewConverter/projectDTOToProject";
import {projectPlainDTOToProjectPreview} from "src/dataAccessLogic/DTOToPreviewConverter/projectPlainDTOToProjectPreview";
import {Project} from "src/model/businessModel/Project";
import {ProjectPreview} from "src/model/businessModelPreview/ProjectPreview";
import {ProjectService} from "src/service/ProjectService";
import {PartialWithUuid} from "src/utils/PartialWithUuid";

/**
 * Create Project params
 */
export interface CreateProjectParams {

  /**
   * User's uuid
   */
  ownerId: string;

  /**
   * Project's name
   */
  name: string;

}

/**
 * Provides methods to interact with the Project model
 */
export class ProjectDAL {

  /**
   * Create Project with empty fields and autogenerated uuid
   */
  public static async createProject(params: CreateProjectParams): Promise<Project> {
    const projectDTO = await ProjectService.createProject({
      request: {
        name: params.name,
        ownerId: params.ownerId,
      },
    });

    const project = projectDTOToProject(projectDTO);

    return project;
  }

  /**
   * Get Project
   */
  public static async getProject(projectId: string): Promise<Project> {
    const projectDTO = await ProjectService.getProjectByUuid({projectId});
    const project = projectDTOToProject(projectDTO);

    return project;
  }

  /**
   * Get projects by user UUID
   */
  public static async getProjectsByUserUuid(userId: string): Promise<ProjectPreview[]> {
    const projectsDTO = await ProjectService.getProjectsByUserId({userId});

    const projects = projectsDTO.projects.map(projectPlainDTOToProjectPreview);

    return projects;
  }

  /**
   * Update Project
   */
  public static async updateProject(project: PartialWithUuid<Project>) {
    const projectDTOPartial = wayToWayDTOPartial(project);
    await ProjectService.updateProject({
      projectId: project.uuid,
      request: projectDTOPartial,
    });
  }

  /**
   * Delete Project
   */
  public static async deleteProject(projectId: string) {
    await ProjectService.deleteProject({projectId});
  }

}
