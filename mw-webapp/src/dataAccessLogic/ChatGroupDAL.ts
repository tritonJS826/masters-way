/* eslint-disable @typescript-eslint/no-explicit-any */
import {
  SchemasDeclineRequestToGroupRoomResponse,
  SchemasGetRequestsToGroupRoomResponse,
  SchemasGetRoomsResponse,
  SchemasRoomPopulatedResponse,
} from "src/apiAutogenerated/chat";
import {chatGroupDTOToChatGroup} from "src/dataAccessLogic/DTOToPreviewConverter/chatGroupDTOToChatGroup";
import {messageDTOToMessage} from "src/dataAccessLogic/DTOToPreviewConverter/messageDTOToMessage";
import {ChatGroup} from "src/model/businessModel/ChatGroup";
import {Message} from "src/model/businessModel/Message";
import {ChatGroupService} from "src/service/ChatGroupService";

/**
 * Add user to group chat params
 */
interface AddUserToGroupParams {

  /**
   * Chat ID
   */
  groupRoomId: string;

  /**
   * USer ID
   */
  userId: string;
}

/**
 * Add user from group chat params
 */
interface DeleteUserFromGroupParams {

  /**
   * Chat ID
   */
  groupRoomId: string;

  /**
   * USer ID
   */
  userId: string;
}

/**
 * Create message in group chat params
 */
interface createMessageInGroupParams {

  /**
   * Chat ID
   */
  groupRoomId: string;

  /**
   * Message's value
   */
  message: string;

  /**
   * Group chat ID
   */
  roomId: string;
}

/**
 * Create request to group params
 */
interface createRequestToGroupParams {

  /**
   * Cgat ID
   */
  roomId: string;

  /**
   * USer ID
   */
  userId: string;
}

/**
 * Provides methods to interact with the group room
 */
export class ChatGroupDAL {

  /**
   * Create group room
   */
  public static async createGroupRoom(params: RequestInit): Promise<ChatGroup> {
    const groupRoomDTO = await ChatGroupService.createGroupRoom(params);
    const groupRoom = chatGroupDTOToChatGroup(groupRoomDTO);

    return groupRoom;
  }

  /**
   * Accept request to group chat room
   */
  public static async acceptRequestToGroupRoom(groupRoomId: string): Promise<ChatGroup> {
    const groupRoomDTO = await ChatGroupService.acceptRequestToGroupRoom({groupRoomId});
    const groupRoom = chatGroupDTOToChatGroup(groupRoomDTO);

    return groupRoom;
  }

  /**
   * Add user to group chat room
   */
  public static async addUserToGroup(params: AddUserToGroupParams): Promise<ChatGroup> {
    const groupRoomDTO: SchemasRoomPopulatedResponse = await ChatGroupService.addUserToGroup({
      groupRoomId: params.groupRoomId,
      userId: params.userId,
    });
    const groupRoom = chatGroupDTOToChatGroup(groupRoomDTO);

    return groupRoom;
  }

  /**
   * Decline request to group chat room
   */
  public static async declineRequestToGroupRoom(groupRoomId: string): Promise<SchemasDeclineRequestToGroupRoomResponse> {
    const groupRoom = await ChatGroupService.declineRequestToGroupRoom({groupRoomId});

    return groupRoom;
  }

  /**
   * Delete user from group chat room
   */
  public static async deleteUserFromGroup(requestParameters: DeleteUserFromGroupParams): Promise<ChatGroup> {
    const groupRoomDTO = await ChatGroupService.deleteUserFromGroup(requestParameters);
    const groupRoom = chatGroupDTOToChatGroup(groupRoomDTO);

    return groupRoom;
  }

  /**
   * Get group chat room by ID
   */
  public static async getGroupRoomById(groupRoomId: string): Promise<ChatGroup> {
    const groupRoomDTO: SchemasRoomPopulatedResponse = await ChatGroupService.getGroupRoomById({groupRoomId});
    const groupRoom = chatGroupDTOToChatGroup(groupRoomDTO);

    return groupRoom;
  }

  /**
   * Get group chat rooms
   */
  public static async getGroupRooms(requestParameters: RequestInit): Promise<SchemasGetRoomsResponse> {
    const groupRooms = await ChatGroupService.getGroupRooms(requestParameters);

    return groupRooms;
  }

  /**
   * Get requests to group chat room
   */
  public static async getRequestsToGroupRoom(requestParameters: RequestInit): Promise<SchemasGetRequestsToGroupRoomResponse> {
    const requestsToGroupRoom = await ChatGroupService.getRequestsToGroupRoom(requestParameters);

    return requestsToGroupRoom;
  }

  /**
   * Create message in group chat room
   */
  public static async createMessageInGroupRoom(params: createMessageInGroupParams): Promise<Message> {
    const messageDTO = await ChatGroupService.createMessageInGroupRoom({
      groupRoomId: params.groupRoomId,
      request: {
        message: params.message,
        roomId: params.roomId,
      },
    });

    const message = messageDTOToMessage(messageDTO);

    return message;
  }

  /**
   * Create request to group chat room
   */
  public static async createRequestToGroupRoom(params: createRequestToGroupParams): Promise<void> {
    await ChatGroupService.createRequestToGroupRoom({
      request: {
        roomId: params.roomId,
        userId: params.userId,
      },
    });
  }

  /**
   * Update group chat room
   */
  public static async updateGroupRooms(groupRoomId: string): Promise<ChatGroup> {
    const groupRoomUpdatedDTO: SchemasRoomPopulatedResponse = await ChatGroupService.updateGroupRooms({groupRoomId});
    const groupRoomUpdated = chatGroupDTOToChatGroup(groupRoomUpdatedDTO);

    return groupRoomUpdated;
  }

}
