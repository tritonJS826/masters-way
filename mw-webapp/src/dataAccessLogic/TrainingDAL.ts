import {trainingToTrainingDTOPartial} from "src/dataAccessLogic/BusinessToDTOConverter/trainingToTrainingDTOPartial";
import {trainingDTOToTraining} from "src/dataAccessLogic/DTOToPreviewConverter/trainingDTOToTraining";
import {trainingPreviewDTOToTrainingPreview} from "src/dataAccessLogic/DTOToPreviewConverter/trainingPreviewDTOToTrainingPreview";
import {GetTrainingsByUserIdParams} from "src/logic/userPage/trainingTab/TrainingTabStore";
import {Training} from "src/model/businessModel/Training";
import {TrainingPreview} from "src/model/businessModelPreview/TrainingPreview";
import {TrainingService} from "src/service/TrainingService";
import {PartialWithUuid} from "src/utils/PartialWithUuid";

/**
 * All trainings params
 */
export interface AllTrainingsParams {

  /**
   * Trainings amount
   */
  size: number;

  /**
   * Array of trainings preview
   */
  trainingsPreview: TrainingPreview[];
}

/**
 * All trainings by user params
 */
export interface AllTrainingsByUserParams {

  /**
   * Trainings amount
   */
  size: number;

  /**
   * Array of trainings preview
   */
  trainingsPreview: TrainingPreview[];

  /**
   * Trainings amount for each collection
   */
  trainingsAmount: TrainingsAmount;
}

/**
 * Pagination and filter params
 */
export interface GetTrainingsParams {

  /**
   * Page
   */
  page?: number;

  /**
   * Limit
   */
  limit?: number;

  /**
   * Part of training name
   */
  trainingName: string;

}

/**
 * Create Training params
 */
export interface CreateTrainingParams {

  /**
   * If true - training is private
   */
  isPrivate: boolean;

  /**
   * Project's name
   */
  name: string;

  /**
   * Training's name
   */
  description: string;

}

/**
 * Trainings amount
 */
export interface TrainingsAmount {

  /**
   * Trainings amount for favorite collection
   */
  favorite: number;

  /**
   *
   * Trainings amount for mentor collection
   */
  mentor: number;

  /**
   * Trainings amount for owner collection
   */
  owner: number;

  /**
   * Trainings amount for student collection
   */
  student: number;
}

/**
 * Provides methods to interact with the Training model
 */
export class TrainingDAL {

  /**
   * Create Training with empty fields and autogenerated uuid
   */
  public static async createTraining(params: CreateTrainingParams): Promise<Training> {
    const trainingDTO = await TrainingService.createTraining({
      request: {
        name: params.name,
        description: params.description,
        isPrivate: params.isPrivate,
      },
    });

    const training = trainingDTOToTraining(trainingDTO);

    return training;
  }

  /**
   * Get all TrainingPreview
   */
  public static async getTrainings(params?: GetTrainingsParams): Promise<AllTrainingsParams> {
    const trainingsPreviewDTO = await TrainingService.getAllTrainings(params);

    const trainingsPreview = trainingsPreviewDTO.trainings.map(trainingPreviewDTOToTrainingPreview);

    const trainings = {
      size: trainingsPreviewDTO.size,
      trainingsPreview,
    };

    return trainings;

  }

  /**
   * Get all user's trainings by user Id
   */
  public static async getTrainingsByUserId(params: GetTrainingsByUserIdParams): Promise<AllTrainingsByUserParams> {
    const trainingsPreviewDTO = await TrainingService.getTrainingsByUserUuid({
      trainingsType: params.trainingsType,
      userId: params.userId,
    });
    const trainingsPreview = trainingsPreviewDTO.trainings.map(trainingPreviewDTOToTrainingPreview);

    const allTrainingsAmount = await TrainingService.getTrainingsAmountByUser({userId: params.userId});

    const trainings = {
      size: trainingsPreviewDTO.size,
      trainingsPreview,
      trainingsAmount: allTrainingsAmount,
    };

    return trainings;
  }

  /**
   * Get Training by Uuid
   */
  public static async getTraining(trainingId: string): Promise<Training> {
    const trainingDTO = await TrainingService.getTrainingByUuid({trainingId});
    const training = trainingDTOToTraining(trainingDTO);

    return training;
  }

  /**
   * Update Training
   */
  public static async updateTraining(training: PartialWithUuid<Training>) {
    const trainingDTOPartial = trainingToTrainingDTOPartial(training);
    await TrainingService.updateTraining({
      trainingId: training.uuid,
      request: trainingDTOPartial,
    });
  }

  /**
   * Delete Training
   */
  public static async deleteTraining(trainingId: string) {
    await TrainingService.deleteTraining({trainingId});
  }

}
