/**
 * Please add clear and descriptive comment for all events and their fields,
 * because they will be used in unpredictable places and with comments it will be easier to
 * understand context and meaning of event.
 */
import {currentWindowEventConfig} from "src/eventBus/eventBus";
import {ChannelId} from "src/eventBus/EventBusChannelDict";
import {populateWithBaseEvent} from "src/eventBus/events/populateWithBaseEvent";
import {TestEventId} from "src/eventBus/events/test/TestEventDict";

/**
 * Users who joined a session
 */
export type UserJoinedSessionPayload = {

  /**
   * User id
   */
  userUuid: string;

  /**
   * User name
   */
  userName: string;
}

/**
 * Factory for {@link UserJoinedSessionPayload} event
 * Used for creating new event objects
 */
export const makeUserJoinedSessionEvent = (payload: UserJoinedSessionPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.USER_JOINED_SESSION,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

/**
 * Event fired when a connection to mw-test-websocket established
 */
export type TestConnectionEstablishedPayload = Record<string, never>;

/**
 * Factory for {@link TestConnectionEstablishedPayload} event
 * Used for creating new event objects
 */
export const makeTestConnectionEstablishedEvent = (payload: TestConnectionEstablishedPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.CONNECTION_ESTABLISHED,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

/**
 * Event fired when a connection to mw-test-websocket closed
 */
export type TestConnectionClosedPayload = Record<string, never>;

/**
 * Factory for {@link TestConnectionEstablishedPayload} event
 * Used for creating new event objects
 */
export const makeTestConnectionClosedEvent = (payload: TestConnectionClosedPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.CONNECTION_CLOSED,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

/**
 * Event fired when user is ready to play sol unity
 */
export type UserReadyToStartPlayPayload = {

  /**
   * User Id
   */
  userUuid: string;
};

/**
 * Factory for {@link UserReadyToStartPlayPayload} event
 * Used for creating new event objects
 */
export const makeUserReadyToStartPlayEvent = (payload: UserReadyToStartPlayPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.USER_READY_TO_START_PLAY,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

/**
 * Event fired when user is ready to play sol unity
 */
export type UserCapturedTargetPayload = {

  /**
   * User Id
   */
  userUuid: string;

  /**
   * Captured question id
   */
  questionUuid: string;
};

/**
 * Factory for {@link UserCapturedTargetPayload} event
 * Used for creating new event objects
 */
export const makeUserCapturedTargetEvent = (payload: UserCapturedTargetPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.USER_CAPTURED_TARGET,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

/**
 * Event fired when user submitted answer
 */
export type UserAnsweredQuestionPayload = {

  /**
   * User Id
   */
  userUuid: string;

  /**
   * Captured question id
   */
  questionUuid: string;
};

/**
 * Factory for {@link UserAnsweredQuestionPayload} event
 * Used for creating new event objects
 */
export const makeUserAnsweredQuestionEvent = (payload: UserAnsweredQuestionPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.USER_ANSWERED_QUESTION,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

/**
 * Event fired when user submitted answer
 */
export type UserAnswerHandledByServerPayload = {

  /**
   * User Id
   */
  userUuid: string;

  /**
   * Is answer right
   */
  isOk: boolean;

  /**
   * User answer
   */
  userAnswer: string;

  /**
   * Question name
   */
  questionName: string;

  /**
   * Question description
   */
  questionDescription: string;

  /**
   * Question answer made by question creator
   */
  questionAnswer: string;

  /**
   * Result description generated by AI or mentor
   */
  resultDescription: string;

  /**
   * Question uuid
   */
  questionUuid: string;

  /**
   * Result uuid
   */
  uuid: string;
};

/**
 * Factory for {@link UserAnswerHandledByServerPayload} event
 * Used for creating new event objects
 */
export const makeUserAnswerHandledByServerEvent = (payload: UserAnswerHandledByServerPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.USER_ANSWER_HANDLED_BY_SERVER,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

/**
 * Event fired when a connection to mw-test-websocket closed
 */
export type HostStartedGamePayload = {

  /**
   * Percentage from 0.01x to 100x. Default 1
   */
  speedScale: number;

  /**
   * Seconds from 1 to 1800. Default 10
   */
  enemySpawnInterval: number;
};

/**
 * Factory for {@link TestConnectionEstablishedPayload} event
 * Used for creating new event objects
 */
export const makeHostStartedGameEvent = (payload: HostStartedGamePayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.HOST_STARTED_GAME,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

export type UserInfo = {

  /**
   * UserUuid
   */
  userUuid: string;

  /**
   * User's name
   */
  userName: string;
}

/**
 * Event fired when a some session data was updated (when launching for example)
 */
export type SessionStateUpdatedPayload = {

  /**
   * List of current users
   */
  currentUsers: UserInfo[];

  /**
   * Self user uuid
   */
  selfUserUuid: string;

  /**
   * Host user uuid
   */
  userHostUuid: string;
};

/**
 * Factory for {@link SessionStateUpdatedPayload} event
 * Used for creating new event objects
 */
export const makeSessionStateUpdatedEvent = (payload: SessionStateUpdatedPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.SESSION_STATE_UPDATED,
    currentWindowEventConfig,
  );

  return populatedEvent;
};

/**
 * Event fired when a connection to mw-test-websocket closed
 */
export type TestRefreshTokenRequiredPayload = Record<string, never>;

/**
 * Factory for {@link TestConnectionEstablishedPayload} event
 * Used for creating new event objects
 */
export const makeTestRefreshTokenRequiredEvent = (payload: TestRefreshTokenRequiredPayload) => {
  const populatedEvent = populateWithBaseEvent(
    payload,
    ChannelId.TEST,
    TestEventId.REFRESH_TOKEN_REQUIRED,
    currentWindowEventConfig,
  );

  return populatedEvent;
};
