package routers

import (
	"context"
	"mwserver/internal/auth"
	"mwserver/internal/config"
	"mwserver/internal/openapi"
	"net/http"
	"testing"

	openapiGeneral "mwserver/apiAutogenerated/general"

	"github.com/stretchr/testify/assert"
)

func TestGetAllWays(t *testing.T) {
	newConfig, err := config.LoadConfig("../../")
	if err != nil {
		t.Fatalf("Failed to load config: %v", err)
	}

	generalApi := openapi.MakeGeneralAPIClient(&newConfig)
	_, err = generalApi.DevAPI.DevResetDbGet(context.Background()).Execute()
	if err != nil {
		t.Fatalf("Failed to reset db: %v", err)
	}

	currentUserID := "d2cb5e1b-44df-48d3-b7a1-34f3d7a5b7e2"

	t.Run("should get all ways successfully", func(t *testing.T) {
		token, err := auth.GenerateJWT(currentUserID, newConfig.SecretSessionKey)
		if err != nil {
			t.Fatalf("Failed to generate JWT: %v", err)
		}

		ctx := context.WithValue(context.Background(), auth.ContextKeyAuthorization, "Bearer "+token)
		ways, response, err := generalApi.WayAPI.GetAllWays(ctx).Page(1).Status("all").MinDayReportsAmount(5).Execute()
		if err != nil {
			t.Fatalf("Failed to create Way: %v", err)
		}

		expectedData := &openapiGeneral.SchemasGetAllWaysResponse{
			Size: 17,
			Ways: []openapiGeneral.SchemasWayPlainResponse{
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  0,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "ronnie stanton goal",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors: []openapiGeneral.SchemasUserPlainResponse{
						{
							CreatedAt:   "2024-07-09 00:00:00",
							Description: "A brief description about Ronnie.",
							Email:       "ronnie.stanton@example.com",
							ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
							IsMentor:    false,
							Name:        "Ronnie Stanton",
							Uuid:        "d63d2f89-6412-4324-8587-7061bf02dca4",
						},
					},
					MetricsDone:  0,
					MetricsTotal: 0,
					Name:         "ronnie stanton way",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about Ronnie.",
						Email:       "ronnie.stanton@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    false,
						Name:        "Ronnie Stanton",
						Uuid:        "d63d2f89-6412-4324-8587-7061bf02dca4",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "9972552a-c0b3-41f3-b464-284d36a36964",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  8,
					EstimationTime:    10101010,
					FavoriteForUsers:  0,
					GoalDescription:   "john doe goal",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "john doe way",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about John.",
						Email:       "john.doe@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fyandex.com%2Fimages%2F",
						IsMentor:    false,
						Name:        "John Doe",
						Uuid:        "7cdb041b-4574-4f7b-a500-c53e74c72e94",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "550e8400-e29b-41d4-a716-446655440000",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{"550e8400-e29b-41d4-a716-446655440000", "54910bd4-ad28-44f4-a669-f233861cf816"},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  1,
					EstimationTime:    10101010,
					FavoriteForUsers:  0,
					GoalDescription:   "john doe composite way",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "john doe composite way 1",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about John.",
						Email:       "john.doe@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fyandex.com%2Fimages%2F",
						IsMentor:    false,
						Name:        "John Doe",
						Uuid:        "7cdb041b-4574-4f7b-a500-c53e74c72e94",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "d6d46085-8ce6-4df1-8463-3e469c240076",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  1,
					EstimationTime:    10101010,
					FavoriteForUsers:  0,
					GoalDescription:   "john doe composite way",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "john doe composite way",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about John.",
						Email:       "john.doe@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fyandex.com%2Fimages%2F",
						IsMentor:    false,
						Name:        "John Doe",
						Uuid:        "7cdb041b-4574-4f7b-a500-c53e74c72e94",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "a73c4484-0a44-4e57-8183-aea93a4ccbbb",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  0,
					EstimationTime:    20202020,
					FavoriteForUsers:  0,
					GoalDescription:   "jane smith goal",
					IsCompleted:       true,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "jane smith way",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about Jane.",
						Email:       "jane.smith@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Jane Smith",
						Uuid:        "8e77b89d-57c4-4b7f-8cd4-8dfc6bcb7d1b",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "9e77b89d-57c4-4b7f-8cd4-8dfc6bcb7d1b",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  1,
					EstimationTime:    20202020,
					FavoriteForUsers:  0,
					GoalDescription:   "jane smith goal 1",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "jane smith way 1",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about Jane.",
						Email:       "jane.smith@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Jane Smith",
						Uuid:        "8e77b89d-57c4-4b7f-8cd4-8dfc6bcb7d1b",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "dce03ca6-f626-4c33-a44b-5a1b4ff62aa7",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  3,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "bob brown goal",
					IsCompleted:       true,
					IsPrivate:         true,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "bob brown way",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about Bob.",
						Email:       "bob.brown@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    false,
						Name:        "Bob Brown",
						Uuid:        "d2cb5e1b-44df-48d3-b7a1-34f3d7a5b7e2",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "32cb5e1b-44df-48d3-b7a1-34f3d7a5b7e2",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  2,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "bob brown goal 1",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "bob brown way 1",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about Bob.",
						Email:       "bob.brown@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    false,
						Name:        "Bob Brown",
						Uuid:        "d2cb5e1b-44df-48d3-b7a1-34f3d7a5b7e2",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "77482c3f-cae6-494d-be1d-d06c1e84450b",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  2,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "bob brown goal 2",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "bob brown way 2",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about Bob.",
						Email:       "bob.brown@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    false,
						Name:        "Bob Brown",
						Uuid:        "d2cb5e1b-44df-48d3-b7a1-34f3d7a5b7e2",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "77a9e7c4-edb4-4b61-8065-cfd0c5c2506d",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  3,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "dana evans goal",
					IsCompleted:       true,
					IsPrivate:         true,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "dana evans way",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about Dana.",
						Email:       "dana.evans@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Dana Evans",
						Uuid:        "1b3d5e7f-5a1e-4d3a-b1a5-d1a1d5b7a7e1",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "e030b296-fa2d-48aa-af0d-c43aa138ee46",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-09 00:00:00",
					DayReportsAmount:  3,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "dana evans goal",
					IsCompleted:       true,
					IsPrivate:         true,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "dana evans way",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-09 00:00:00",
						Description: "A brief description about Dana.",
						Email:       "dana.evans@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Dana Evans",
						Uuid:        "1b3d5e7f-5a1e-4d3a-b1a5-d1a1d5b7a7e1",
					},
					UpdatedAt: "2024-07-09 00:00:00",
					Uuid:      "e030b296-fa2d-48aa-af0d-c43aa138ee46",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-22 00:00:00",
					DayReportsAmount:  1,
					EstimationTime:    30303030,
					FavoriteForUsers:  0,
					GoalDescription:   "alice johnson goal",
					IsCompleted:       false,
					IsPrivate:         true,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "alice johnson",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-22 00:00:00",
						Description: "A brief description about Alice.",
						Email:       "alice.johnson@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Alice Johnson",
						Uuid:        "3d922e8a-5d58-4b82-9a3d-83e2e73b3f91",
					},
					UpdatedAt: "2024-07-22 00:00:00",
					Uuid:      "1d922e8a-5d58-4b82-9a3d-83e2e73b3f91",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-22 00:00:00",
					DayReportsAmount:  0,
					EstimationTime:    30303030,
					FavoriteForUsers:  0,
					GoalDescription:   "alice johnson goal 1",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "alice johnson 1",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-22 00:00:00",
						Description: "A brief description about Alice.",
						Email:       "alice.johnson@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Alice Johnson",
						Uuid:        "3d922e8a-5d58-4b82-9a3d-83e2e73b3f91",
					},
					UpdatedAt: "2024-07-22 00:00:00",
					Uuid:      "5cc724a0-383f-45ad-99a1-8514f51717f2",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-07-22 00:00:00",
					DayReportsAmount:  0,
					EstimationTime:    30303030,
					FavoriteForUsers:  0,
					GoalDescription:   "alice johnson goal 2",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "alice johnson 2",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-07-22 00:00:00",
						Description: "A brief description about Alice.",
						Email:       "alice.johnson@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Alice Johnson",
						Uuid:        "3d922e8a-5d58-4b82-9a3d-83e2e73b3f91",
					},
					UpdatedAt: "2024-07-22 00:00:00",
					Uuid:      "78f86c77-2018-4511-90dc-d96df77f496a",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-08-10 00:00:00",
					DayReportsAmount:  0,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "dana evans goal 1",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "dana evans way 1",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-08-10 00:00:00",
						Description: "A brief description about Dana.",
						Email:       "dana.evans@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Dana Evans",
						Uuid:        "1b3d5e7f-5a1e-4d3a-b1a5-d1a1d5b7a7e1",
					},
					UpdatedAt: "2024-08-10 00:00:00",
					Uuid:      "a2cb5e1b-44df-48d3-b7a1-34f3d7a5b7e2",
					WayTags: []openapiGeneral.SchemasWayTagResponse{
						{
							Name: "some tag",
							Uuid: "46d5dd00-75fc-4563-9616-5252a6fa05d3",
						},
					},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-08-10 00:00:00",
					DayReportsAmount:  0,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "dana evans goal 2",
					IsCompleted:       false,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "dana evans way 2",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-08-10 00:00:00",
						Description: "A brief description about Dana.",
						Email:       "dana.evans@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Dana Evans",
						Uuid:        "1b3d5e7f-5a1e-4d3a-b1a5-d1a1d5b7a7e1",
					},
					UpdatedAt: "2024-08-10 00:00:00",
					Uuid:      "aa13eee9-7dca-46ed-a3f7-21d8b7ae3b72",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
				{
					ChildrenUuids:     []string{},
					CopiedFromWayUuid: openapiGeneral.NullableString{},
					CreatedAt:         "2024-08-10 00:00:00",
					DayReportsAmount:  2,
					EstimationTime:    40404040,
					FavoriteForUsers:  0,
					GoalDescription:   "dana evans goal 3",
					IsCompleted:       true,
					IsPrivate:         false,
					Mentors:           []openapiGeneral.SchemasUserPlainResponse{},
					MetricsDone:       0,
					MetricsTotal:      0,
					Name:              "dana evans way 3",
					Owner: openapiGeneral.SchemasUserPlainResponse{
						CreatedAt:   "2024-08-10 00:00:00",
						Description: "A brief description about Dana.",
						Email:       "dana.evans@example.com",
						ImageUrl:    "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.gettyimages.com%2F",
						IsMentor:    true,
						Name:        "Dana Evans",
						Uuid:        "1b3d5e7f-5a1e-4d3a-b1a5-d1a1d5b7a7e1",
					},
					UpdatedAt: "2024-08-10 00:00:00",
					Uuid:      "9230479a-a481-4f83-b770-138ef4f3139c",
					WayTags:   []openapiGeneral.SchemasWayTagResponse{},
				},
			},
		}

		assert.Equal(t, http.StatusOK, response.StatusCode)
	})
}
