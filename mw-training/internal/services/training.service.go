package services

import (
	"context"
	db "mw-training/internal/db/sqlc"
	pb "mw-training/pkg/grpcAutoGenerated/training"

	"github.com/jackc/pgx/v5"
	"github.com/jackc/pgx/v5/pgtype"
	"github.com/jackc/pgx/v5/pgxpool"
)

type TrainingRepository interface {
	CreateTraining(ctx context.Context, params db.CreateTrainingParams) (pb.Training, error)
	UpdateTraining(ctx context.Context, params db.UpdateTrainingParams) (pb.Training, error)
	DeleteTraining(ctx context.Context, trainingUuid pgtype.UUID) error
	WithTx(tx pgx.Tx) *db.Queries
}

type TrainingService struct {
	trainingRepository TrainingRepository
	pgxPool            *pgxpool.Pool
}

func NewTrainingService(pgxPool *pgxpool.Pool, trainingRepository TrainingRepository) *TrainingService {
	return &TrainingService{
		pgxPool:            pgxPool,
		trainingRepository: trainingRepository,
	}
}

func (ts *TrainingService) CreateTraining(ctx context.Context, params db.CreateTrainingParams) (pb.Training, error) {
	return ts.trainingRepository.CreateTraining(ctx, params)
}

func (ts *TrainingService) UpdateTraining(ctx context.Context, params db.UpdateTrainingParams) (pb.Training, error) {
	return ts.trainingRepository.UpdateTraining(ctx, params)
}

func (ts *TrainingService) DeleteTraining(ctx context.Context, trainingUuid pgtype.UUID) error {
	return ts.trainingRepository.DeleteTraining(ctx, trainingUuid)
}
