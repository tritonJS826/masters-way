package controllers

import (
	"context"

	db "mw-training/internal/db/sqlc"
	services "mw-training/internal/services"
	pb "mw-training/pkg/grpcAutogenerated/training"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
	"google.golang.org/protobuf/types/known/emptypb"
)

type TrainingMentorController struct {
	trainingMentorService *services.TrainingMentorService
	pb.TrainingMentorServiceServer
}

func NewTrainingMentorController(trainingMentorService *services.TrainingMentorService) *TrainingMentorController {
	return &TrainingMentorController{trainingMentorService: trainingMentorService}
}

func (ftc *TrainingMentorController) CreateTrainingMentor(ctx context.Context, in *pb.CreateTrainingMentorRequest) (*emptypb.Empty, error) {
	mentorUuid := in.GetMentorUuid()
	trainingUuid := in.GetTrainingUuid()
	arg := db.CreateTrainingMentorParams{
		TrainingUuid: pgtype.UUID{Bytes: uuid.MustParse(trainingUuid), Valid: true},
		MentorUuid:   pgtype.UUID{Bytes: uuid.MustParse(mentorUuid), Valid: true},
	}

	_, err := ftc.trainingMentorService.CreateTrainingMentor(ctx, arg)
	if err != nil {
		return nil, err
	}

	return &emptypb.Empty{}, nil
}

func (ftc *TrainingMentorController) DeleteTrainingMentorByIds(ctx context.Context, in *pb.DeleteTrainingMentorRequest) (*emptypb.Empty, error) {
	mentorUuid := in.GetMentorUuid()
	trainingUuid := in.GetTrainingUuid()
	arg := db.DeleteTrainingMentorByIdsParams{
		TrainingUuid: pgtype.UUID{Bytes: uuid.MustParse(trainingUuid), Valid: true},
		MentorUuid:   pgtype.UUID{Bytes: uuid.MustParse(mentorUuid), Valid: true},
	}

	err := ftc.trainingMentorService.DeleteTrainingMentorByIds(ctx, arg)
	if err != nil {
		return nil, err
	}

	return &emptypb.Empty{}, nil
}
