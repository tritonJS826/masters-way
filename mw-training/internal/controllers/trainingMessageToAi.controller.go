package controllers

import (
	"context"

	services "mw-training/internal/services"
	pb "mw-training/pkg/grpcAutogenerated/training"

	"google.golang.org/protobuf/types/known/emptypb"
)

type TrainingMessageToAiController struct {
	trainingMessageToAiService *services.TrainingMessageToAiService
	pb.TrainingMessageToAIServiceServer
}

func NewTrainingMessageToAiController(trainingMessageToAiService *services.TrainingMessageToAiService) *TrainingMessageToAiController {
	return &TrainingMessageToAiController{trainingMessageToAiService: trainingMessageToAiService}
}

func (tc *TrainingMessageToAiController) GetMessageToAI(ctx context.Context, in *emptypb.Empty) (*pb.MessageToAI, error) {
	messageToAI, err := tc.trainingMessageToAiService.GetMessageToAI(ctx)
	if err != nil {
		return nil, err
	}

	return messageToAI, nil
}

func (tc *TrainingMessageToAiController) HandleResponseFromAiForItem(ctx context.Context, in *pb.MessageFromAI) (*emptypb.Empty, error) {
	messageResponse := in.GetMessageResponse()
	messageUuid := in.GetUuid()

	arg := &pb.MessageFromAI{
		Uuid:            messageUuid,
		MessageResponse: messageResponse,
	}

	_ = tc.trainingMessageToAiService.HandleResponseFromAiForItem(ctx, arg)

	return nil, nil
}
