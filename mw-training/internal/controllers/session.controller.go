package controllers

import (
	"context"
	"mw-training/internal/services"

	pb "mw-training/pkg/grpcAutogenerated/training"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

type SessionController struct {
	sessionService *services.SessionService
	pb.UnimplementedSessionServiceServer
}

func NewSessionController(sessionService *services.SessionService) *SessionController {
	return &SessionController{sessionService: sessionService}
}

func (c *SessionController) CreateSession(ctx context.Context, in *pb.CreateSessionRequest) (*pb.CreateSessionResult, error) {
	userUuid := in.GetUserUuid()

	args := pgtype.UUID{Bytes: uuid.MustParse(userUuid), Valid: true}

	session, err := c.sessionService.CreateSession(ctx, args)
	if err != nil {
		return nil, err
	}

	return session, err
}
