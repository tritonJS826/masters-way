syntax = "proto3";

option go_package = "pkg/training";

package training;

import "google/protobuf/empty.proto";

service TrainingTrainingTagService {
  rpc CreateTrainingTrainingTag(CreateTrainingTagRequest) returns (TrainingTag);
  rpc GetTrainingTags(GetTrainingTagsRequest) returns (TrainingTagList);
  rpc DeleteTrainingTrainingTag(DeleteTrainingTagRequest) returns (google.protobuf.Empty);
}


service TrainingService {
  rpc CreateNewTraining(CreateTrainingRequest) returns (Training);
  rpc GetTrainingById(GetTrainingRequest) returns (Training);
  rpc GetTrainingListForUser(GetTrainingListForUserRequest) returns (TrainingPreviewList);
  rpc GetTrainingsAmountByUserId(GetTrainingsAmountByUserIdRequest) returns (TrainingsAmount);
  rpc GetTrainingList(GetTrainingListRequest) returns (TrainingPreviewList);
  rpc UpdateTraining(UpdateTrainingRequest) returns (Training);
  rpc DeleteTraining(DeleteTrainingRequest) returns (google.protobuf.Empty);
}

service TrainingMentorService {
  rpc CreateTrainingMentor(CreateTrainingMentorRequest) returns (google.protobuf.Empty);
  rpc DeleteTrainingMentor(DeleteTrainingMentorRequest) returns (google.protobuf.Empty);
}

service TrainingStudentService {
  rpc CreateTrainingStudent(CreateTrainingStudentRequest) returns (google.protobuf.Empty);
  rpc DeleteTrainingStudent(DeleteTrainingStudentRequest) returns (google.protobuf.Empty);
}

service FavoriteUsersTrainingsService {
  rpc CreateFavoriteUserTraining(CreateFavoriteUserTrainingRequest) returns (google.protobuf.Empty);
  rpc DeleteFavoriteUserTraining(DeleteFavoriteUserTrainingRequest) returns (google.protobuf.Empty);
}

service PracticeMaterialService {
  rpc CreatePracticeMaterial(CreatePracticeMaterialRequest) returns (PracticeMaterial);
  rpc UpdatePracticeMaterial(UpdatePracticeMaterialRequest) returns (PracticeMaterial);
  rpc DeletePracticeMaterial(DeletePracticeMaterialRequest) returns (google.protobuf.Empty);
}

service TheoryMaterialService {
  rpc CreateTheoryMaterial(CreateTheoryMaterialRequest) returns (TheoryMaterial);
  rpc UpdateTheoryMaterial(UpdateTheoryMaterialRequest) returns (TheoryMaterial);
  rpc DeleteTheoryMaterial(DeleteTheoryMaterialRequest) returns (google.protobuf.Empty);
}

service TopicsService {
  rpc GetTopicById(GetTopicByIdRequest) returns (Topic);
  rpc CreateTopic(CreateTopicRequest) returns (TopicPreview);
  rpc UpdateTopic(UpdateTopicRequest) returns (TopicPreview);
  rpc DeleteTopic(DeleteTopicRequest) returns (google.protobuf.Empty);
}

service Dev {
  rpc ResetDB(google.protobuf.Empty) returns (google.protobuf.Empty);
}

service TrainingMessageToAIService {
  rpc GetMessageToAI(google.protobuf.Empty) returns (MessageToAI);
  rpc HandleResponseFromAiForItem(MessageFromAI) returns(google.protobuf.Empty);
}

service TestService {
  rpc GetTestList(GetTestListRequest) returns (TestPreviewList);
  rpc GetTestsByUserId(GetTestsByUserIdRequest) returns (TestPreviewList);
  rpc GetTestAmountByUserId(GetTestsAmountByUserIdRequest) returns (GetTestAmountByUserIdResponse);
  rpc CreateTest(CreateTestRequest) returns (Test);
  rpc GetTestById(GetTestByIdRequest) returns (Test);
  rpc UpdateTest(UpdateTestRequest) returns (Test);
  rpc DeleteTest(DeleteTestRequest) returns (google.protobuf.Empty);
}

service TrainingTestsService {
  rpc CreateTrainingTest(CreateTrainingTestRequest) returns (google.protobuf.Empty);
}

service SessionService {
  rpc CreateSession(CreateSessionRequest) returns (CreateSessionResult);
}

service QuestionService {
  rpc CreateQuestion(CreateQuestionRequest) returns (Question);
  rpc UpdateQuestion(UpdateQuestionRequest) returns (Question);
  rpc DeleteQuestion(DeleteQuestionRequest) returns (google.protobuf.Empty);
}

service QuestionResultsService {
  rpc CreateQuestionResult(CreateQuestionResultRequest) returns (QuestionResult);
  rpc GetQuestionResultsBySessionUuid(GetQuestionResultsBySessionUuidRequest) returns (GetQuestionResultsBySessionUuidResponse);
}

service TestSessionResultsService {
  rpc GetTestSessionResult(GetTestSessionResultRequest) returns (GetTestSessionResultResponse);
}

message CreateTrainingTagRequest {
  string training_uuid = 1;
  string tag_name = 2;
}

message TrainingTag {
  string tag_name = 1;
}

message TrainingTagList {
  repeated TrainingTag Training_tag_list = 1;
}

message GetTrainingTagsRequest {
  string training_uuid = 1;
}

message DeleteTrainingTagRequest {
  string training_uuid = 1;
  string tag_name = 2;
}

message CreateTrainingRequest {
  string name = 1;
  string user_id = 2;
  string description = 3;
  bool IsPrivate = 4;
}

message User {
  string uuid = 1;
  string name = 2;
  string image_url = 3;
}

message Training {
  string uuid = 1;
  string name = 2;
  string description = 3;
  User owner = 4;
  string created_at = 5;
  string updated_at = 6;
  bool is_private = 7;
  repeated TrainingTag training_tag_list = 8;
  repeated User training_students = 9;
  repeated User training_mentors = 10;
  repeated string favorite_for_users_preview = 11;
  repeated TopicTreeNode topicsTree = 12;
}

message TopicTreeNode {
  TopicPreview topic = 1;
  repeated TopicTreeNode children = 2; 
}

message TrainingPreview {
  string uuid = 1;
  string name = 2;
  string description = 3;
  User owner = 4;
  string created_at = 5;
  string updated_at = 6;
  bool is_private = 7;
  repeated TrainingTag training_tag_list = 8;
  repeated User training_students = 9;
  repeated User training_mentors = 10;
  int32 favorite_count = 11;
  int32 topics_amount = 12;
}

message TrainingPreviewList {
  int32 size = 1;
  repeated TrainingPreview Training_list = 2;
}

message GetTrainingRequest {
  string training_uuid = 1;
}

message GetTrainingListRequest {
  int32 page = 1;
  int32 limit = 2;
  string training_name = 3;
}

message GetTrainingListForUserRequest {
  string user_uuid = 1;
  string training_type = 2;
}

message GetTrainingsAmountByUserIdRequest {
  string user_uuid = 1;
}

message TrainingsAmount {
  int32 owner = 1;
  int32 mentor = 2;
  int32 student = 3;
  int32 favorite = 4; 
}

message UpdateTrainingRequest {
  string uuid = 1;
  optional string name = 2;
  optional string description = 3;
  optional bool is_private = 4;
  string ownerUuid = 5;
}

message DeleteTrainingRequest {
  string uuid = 1;
}

message CreateTrainingMentorRequest {
  string training_uuid = 1;
  string mentor_uuid = 2;
}

message DeleteTrainingMentorRequest {
  string training_uuid = 1;
  string mentor_uuid = 2;
}

message CreateTrainingStudentRequest {
  string training_uuid = 1;
  string student_uuid = 2;
}

message DeleteTrainingStudentRequest {
  string training_uuid = 1;
  string student_uuid = 2;
}

message CreateFavoriteUserTrainingRequest {
  string training_uuid = 1;
  string user_uuid = 2;
}

message DeleteFavoriteUserTrainingRequest {
  string training_uuid = 1;
  string user_uuid = 2;
}

message CreatePracticeMaterialRequest {
  string topic_uuid = 1;
  string name = 2;
  int32 order = 3;
  string description = 4;
  string answer = 5;
  string practice_type = 6;
  int32 time_to_answer = 7;
}

message PracticeMaterial {
  string uuid = 1;
  string topic_uuid = 2;
  string name = 3;
  int32 order = 4;
  string description = 5;
  string answer = 6;
  string practice_type = 7;
  int32 time_to_answer = 8;
  string created_at = 9;
  string updated_at = 10;
}

message UpdatePracticeMaterialRequest {
  string uuid = 1;
  optional string name = 2;
  optional string description = 3;
  optional string answer = 4;
  optional string practice_type = 5;
  optional int32 time_to_answer = 6;
}

message DeletePracticeMaterialRequest {
  string material_uuid = 1;
}

message CreateTheoryMaterialRequest {
  string topic_uuid = 1;
  string name = 2;
  string description = 3;
}

message TheoryMaterial {
  string uuid = 1;
  string topic_uuid = 2;
  string name = 3;
  string description = 4;
  int32 order = 5;
  string created_at = 6;
  string updated_at = 7;
}

message UpdateTheoryMaterialRequest {
  string uuid = 1;
  optional string name = 2;
  optional string description = 3;
}

message DeleteTheoryMaterialRequest {
  string uuid = 1;
}

message GetTopicByIdRequest {
  string topic_uuid = 1;
}

message CreateTopicRequest {
  string name = 1;
  string training_uuid = 2;
  int32  topic_order = 3;
  optional string parent_topic_uuid = 4;
}

message TopicPreview {
  string uuid = 1;
  string name = 2;
  string training_uuid = 3;
  int32  topic_order = 4;
  optional string parent_topic_uuid = 5;
  string created_at = 6;
  int32 theory_materials_amount = 7;
  int32 practice_materials_amount = 8;
}

message Topic {
  string uuid = 1;
  string name = 2;
  string training_uuid = 3;
  int32  topic_order = 4;
  string owner_uuid = 5;
  optional string parent_topic_uuid = 6;
  string created_at = 7;
  repeated TheoryMaterial theory_materials = 8;
  repeated PracticeMaterial practice_materials = 9;
}

message UpdateTopicRequest {
  string uuid = 1;
  string name = 2;
}

message DeleteTopicRequest {
  string topic_uuid = 1;
}

message GetTestListRequest {
  string name = 1;
  int32 page = 2;
  int32 limit = 3;
}

message TestPreview {
  string uuid = 1;
  string name = 2;
  string description = 3;
  string owner_uuid = 4;
  string updated_at = 5;
  string created_at = 6;
}

message TestPreviewList {
  int32 size = 1;
  repeated TestPreview tests_list = 2;
}

message GetTestsAmountByUserIdRequest {
  string user_uuid = 1;
}

message GetTestAmountByUserIdResponse {
  int32 own = 1;
  int32 completed = 2;
}

message CreateTestRequest {
  string name = 1;
  string description = 2;
  bool is_private = 3;
  string owner_uuid = 4;
}

message UpdateTestRequest {
  string test_uuid = 1;
  string user_uuid = 2;
  optional string name = 3;
  optional string description = 4;
  optional bool is_private = 5;
}

message Test {
  string uuid = 1;
  string name = 2;
  string description = 3;
  string owner_uuid = 4;
  string updated_at = 5;
  string created_at = 6;
  repeated Question questions = 7;
}

message Question {
  string uuid = 1;
  string test_uuid = 2;
  string question_text = 3;
  int32 order = 4;
  int32 time_to_answer = 5;
  string answer = 6;
  bool is_active = 7;
  string created_at = 8;
  string updated_at = 9;
}

message GetTestByIdRequest {
  string uuid = 1;
  string owner_uuid = 2;
}

message DeleteTestRequest {
  string test_uuid = 1;
  string owner_uuid = 2;
}

message GetTestsByUserIdRequest {
  string owner_uuid = 1;
  string user_uuid = 2;
}

message CreateTrainingTestRequest {
  string training_uuid = 1;
  string test_uuid = 2;
  string test_owner_uuid = 3; 
}

message CreateQuestionRequest {
  string test_uuid = 1;
  string user_uuid = 2;
  string name = 3;
  optional string question_text = 4;
  optional int32 time_to_answer = 5;
  optional string answer = 6;
  string practice_type = 7;
  // string topic_uuid = 8; good to provide a link to appropriate answer
}

message UpdateQuestionRequest {
  string question_uuid = 1;
  string user_uuid = 2;
  optional string name = 3;
  optional string question_text = 4;
  optional int32 time_to_answer = 5;
  optional string answer = 6;
  optional string practice_type = 7;
  optional int32 order = 8;
}

message DeleteQuestionRequest {
  string user_uuid = 1;
  string question_uuid = 2;
}

message QuestionResult {
  string uuid = 1;
  string question_uuid = 2;
  string user_uuid = 3;
  string test_uuid = 4;
  string test_session_uuid = 5;
  bool is_ok = 6;
  string result_description = 7;
  string created_at = 8;
}

message CreateQuestionResultRequest {
  string question_uuid = 1;
  string user_uuid = 2;
  string test_uuid = 3;
  string test_session_uuid = 4;
  bool is_ok = 5;
  string result_description = 6;
}

message GetQuestionResultsBySessionUuidRequest {
  string session_uuid = 1;
  string user_uuid = 2; 
}

message GetQuestionResultsBySessionUuidResponse {
  repeated QuestionResult results = 1;
}

message CreateSessionRequest {
  string user_uuid = 1;
}

message CreateSessionResult {
  string session_uuid = 1;
}

message GetTestSessionResultRequest {
  string session_uuid = 1;
  string user_uuid = 2; 
}

message GetTestSessionResultResponse {
  string session_uuid = 1;
  string test_uuid = 2;
  string result_description = 3;
  string created_at = 4;
}

message MessageToAI {
  string uuid = 1;
  string message = 2;
}

message MessageFromAI {
  string uuid = 1;
  string messageResponse = 2;
}
